(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{547:function(s,t,a){"use strict";a.r(t);var e=a(8),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"基础"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础"}},[s._v("#")]),s._v(" 基础")]),s._v(" "),t("h2",{attrs:{id:"mybatis使用过程-生命周期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mybatis使用过程-生命周期"}},[s._v("#")]),s._v(" MyBatis使用过程？生命周期？")]),s._v(" "),t("p",[s._v("MyBatis基本使用的过程大概可以分为这么几步：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/9656569582929.png",alt:"9656569582929"}})]),s._v(" "),t("p",[s._v("1、 创建SqlSessionFactory")]),s._v(" "),t("p",[s._v("可以从配置或者直接编码来创建SqlSessionFactory")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" resource "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org/mybatis/example/mybatis-config.xml"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InputStream")]),s._v(" inputStream "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResourceAsStream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("resource"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionFactory")]),s._v(" sqlSessionFactory "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionFactoryBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("inputStream"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("2、 通过SqlSessionFactory创建SqlSession")]),s._v(" "),t("p",[s._v("SqlSession（会话）可以理解为程序和数据库之间的桥梁")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSession")]),s._v(" session "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sqlSessionFactory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("openSession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("3、通过sqlsession执行数据库操作")]),s._v(" "),t("p",[s._v("可以通过 SqlSession 实例来直接执行已映射的 SQL 语句：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Blog")]),s._v(" blog "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Blog")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("selectOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org.mybatis.example.BlogMapper.selectBlog"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("4、 调用session.commit()提交事务")]),s._v(" "),t("p",[s._v("如果是更新、删除语句，我们还需要提交一下事务。")]),s._v(" "),t("p",[s._v("5、 调用session.close()关闭会话")]),s._v(" "),t("p",[s._v("最后一定要记得关闭会话。")]),s._v(" "),t("h2",{attrs:{id:"说说mybatis的一级、二级缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#说说mybatis的一级、二级缓存"}},[s._v("#")]),s._v(" 说说Mybatis的一级、二级缓存？")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240313211726262.png",alt:"image-20240313211726262"}})]),s._v(" "),t("h3",{attrs:{id:"一级缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一级缓存"}},[s._v("#")]),s._v(" 一级缓存")]),s._v(" "),t("p",[s._v("**也叫做会话级缓存，生命周期仅存在于当前会话，不可以直接关闭。但可以通过flushCache和localCacheScope对其做相应控制。**MyBatis默认打开一级缓存。")]),s._v(" "),t("p",[t("strong",[s._v("缓存命中参数：")])]),s._v(" "),t("ol",[t("li",[s._v("SQL与参数相同：")]),s._v(" "),t("li",[s._v("同一个会话：")]),s._v(" "),t("li",[s._v("相同的MapperStatement ID：")]),s._v(" "),t("li",[s._v("RowBounds行范围相同：")])]),s._v(" "),t("p",[t("strong",[s._v("触发清空缓存")])]),s._v(" "),t("ol",[t("li",[s._v("手动调用clearCache")]),s._v(" "),t("li",[s._v("执行提交回滚")]),s._v(" "),t("li",[s._v("执行update")]),s._v(" "),t("li",[s._v("配置flushCache=true")]),s._v(" "),t("li",[s._v("缓存作用域为Statement")])]),s._v(" "),t("h3",{attrs:{id:"二级缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二级缓存"}},[s._v("#")]),s._v(" 二级缓存")]),s._v(" "),t("p",[s._v("也叫应用级性缓存，与一级缓存不同的，它的作用范围是整个应用，而且可以跨线程使用。所以二级缓存有更高的命中率，适合缓存一些修改较少的数据。在流程上是先访问二级缓存，在访问一级缓存。")]),s._v(" "),t("blockquote",[t("p",[s._v("使用二级缓存属性类需要实现Serializable序列化接口(可用来保存对象的状态)，可在它的映射文件中配置")])]),s._v(" "),t("p",[t("strong",[s._v("二级默认缓存默认是不开启的")]),s._v("，需要为其声明缓存空间才可以使用，通过@CacheNamespace 或 为指定的MappedStatement声明。声明之后该缓存为该Mapper所独有，其它Mapper不能访问。如需要多个Mapper共享一个缓存空间可通过@CacheNamespaceRef 或进行引用同一个缓存空间。@CacheNamespace 详细配置见下表：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("配置")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("implementation")]),s._v(" "),t("td",[s._v("指定缓存的存储实现类，默认是用HashMap存储在内存当中")])]),s._v(" "),t("tr",[t("td",[s._v("eviction")]),s._v(" "),t("td",[s._v("指定缓存溢出淘汰实现类，默认LRU ，清除最少使用")])]),s._v(" "),t("tr",[t("td",[s._v("flushInterval")]),s._v(" "),t("td",[s._v("设置缓存定时全部清空时间，默认不清空。")])]),s._v(" "),t("tr",[t("td",[s._v("size")]),s._v(" "),t("td",[s._v("指定缓存容量，超出后就会按eviction指定算法进行淘汰")])]),s._v(" "),t("tr",[t("td",[s._v("readWrite")]),s._v(" "),t("td",[s._v("true即通过序列化复制，来保证缓存对象是可读写的，默认true")])]),s._v(" "),t("tr",[t("td",[s._v("blocking")]),s._v(" "),t("td",[s._v("为每个Key的访问添加阻塞锁，防止缓存击穿")])]),s._v(" "),t("tr",[t("td",[s._v("properties")]),s._v(" "),t("td",[s._v("为上述组件，配置额外参数，key对应组件中的字段名")])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);