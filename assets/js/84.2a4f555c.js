(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{414:function(t,a,s){"use strict";s.r(a);var e=s(8),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"thingsboard的源码安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thingsboard的源码安装"}},[t._v("#")]),t._v(" ThingsBoard的源码安装")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://thingsboard.io/docs/user-guide/install/building-from-source/",target:"_blank",rel:"noopener noreferrer"}},[t._v("从源代码构建 |ThingsBoard 社区版"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://thingsboard.io/docs/user-guide/install/windows/",target:"_blank",rel:"noopener noreferrer"}},[t._v("在 Windows 上安装 ThingsBoard |ThingsBoard 社区版"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("我们是在windows上安装所以上面两份文档结合看。")]),t._v(" "),a("h2",{attrs:{id:"开发环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发环境"}},[t._v("#")]),t._v(" 开发环境")]),t._v(" "),a("ul",[a("li",[t._v("Java 11")]),t._v(" "),a("li",[t._v("Maven 3.6.0+")]),t._v(" "),a("li",[t._v("Git")]),t._v(" "),a("li",[t._v("IDEA")]),t._v(" "),a("li",[t._v("Nodejs")]),t._v(" "),a("li",[t._v("Redis")]),t._v(" "),a("li",[t._v("postgresql 11.7+")])]),t._v(" "),a("h2",{attrs:{id:"源码拉取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码拉取"}},[t._v("#")]),t._v(" 源码拉取")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/thingsboard/thingsboard",target:"_blank",rel:"noopener noreferrer"}},[t._v("ThingsBoard源码地址"),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("p",[t._v("本次编译的源码版本是v3.6.4")])]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# checkout latest release branch")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-b")]),t._v(" release-3.6 git@github.com:thingsboard/thingsboard.git "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--depth")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h2",{attrs:{id:"配置-thingsboard-数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-thingsboard-数据库"}},[t._v("#")]),t._v(" 配置 ThingsBoard 数据库")]),t._v(" "),a("h3",{attrs:{id:"docker版本的postgres安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker版本的postgres安装"}},[t._v("#")]),t._v(" Docker版本的postgres安装")]),t._v(" "),a("p",[t._v("在PostgreSQL安装时系统将提示您输入超级用户(postgres)密码。")]),t._v(" "),a("p",[t._v("请一定牢记此密码，为了方便记忆我们将密码替换为postgres。")]),t._v(" "),a("p",[a("strong",[t._v("运行并创建容器")])]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" postgres "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--privileged")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("POSTGRES_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("postgres "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v(":5432 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("thingsboard"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("data:/var/lib/postgresql/data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" postgres\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("ul",[a("li",[a("code",[t._v("–name postgres")]),t._v("：指定容器的名称；")]),t._v(" "),a("li",[a("code",[t._v("-e POSTGRES_PASSWORD=postgres")]),t._v("：设置环境变量，这里为设定PostgreSQL数据库的密码；")]),t._v(" "),a("li",[a("code",[t._v("-p 5432:5432")]),t._v("：指定端口映射，前者为宿主机访问端口，后者为容器内端口。如果不指定端口映射，只有在容器内可以访问数据库，外部是无法访问的；")]),t._v(" "),a("li",[a("code",[t._v("-v D:\\java\\thingsboard\\docke\\postgres\\data:/var/lib/postgresql/data")]),t._v("：v是volume的简写，即绑定一个卷，冒号前的路径为宿主机的路径（如果指定路径不存在会自动创建目录），冒号后为容器内路径。容器会把宿主机的目录映射到容器内的路径，这样容器运行中生成的数据实际上就是写到了宿主机的指定路径上，即使容器删除了，此路径的文件也不会删除，这样就做到了数据库的持久化存储。还可以通过docker volume提供的相关命令显式地创建volume，然后再挂载到容器上，这里不做介绍，请自行查询相关内容；")]),t._v(" "),a("li",[a("code",[t._v("-d")]),t._v("：表示后台运行容器；")]),t._v(" "),a("li",[a("code",[t._v("postgres")]),t._v("：表示镜像的名称，docker基于上步拉取的镜像创建出容器；")])]),t._v(" "),a("p",[a("strong",[t._v("查看容器日志")])]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" logs postgres\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424143523216.png",alt:"image-20240424143523216"}})]),t._v(" "),a("p",[a("strong",[t._v("容器内连接数据库")])]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" postgres /bin/bash\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[t._v("exec：在容器中运行命令")]),t._v(" "),a("li",[t._v("postgres：为容器名称")]),t._v(" "),a("li",[t._v("-it：表示在当前终端为容器分配一个伪终端")]),t._v(" "),a("li",[t._v("/bin/bash：容器内运行/bin/bash终端")])]),t._v(" "),a("h3",{attrs:{id:"初始化数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化数据库"}},[t._v("#")]),t._v(" 初始化数据库")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424170148457.png",alt:"image-20240424170148457"}})]),t._v(" "),a("p",[t._v("创建一个名为thingsboard的数据库")]),t._v(" "),a("p",[t._v("执行application/src/main/java/org.thingsboard.server.ThingsboardInstallApplication初始化数据源")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424170239425.png",alt:"image-20240424170239425"}})]),t._v(" "),a("p",[t._v("执行完成查看数据库中是否创建好了表：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424170328088.png",alt:"image-20240424170328088"}})]),t._v(" "),a("h2",{attrs:{id:"选择-thingsboard-队列服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选择-thingsboard-队列服务"}},[t._v("#")]),t._v(" 选择 ThingsBoard 队列服务")]),t._v(" "),a("p",[t._v("先选择默认的")]),t._v(" "),a("h2",{attrs:{id:"运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[t._v("#")]),t._v(" 运行")]),t._v(" "),a("h3",{attrs:{id:"启动后端服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动后端服务"}},[t._v("#")]),t._v(" 启动后端服务")]),t._v(" "),a("p",[t._v("执行application/src/main/java/org.thingsboard.server.ThingsboardServerApplication启动服务")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424170359680.png",alt:"image-20240424170359680"}})]),t._v(" "),a("h3",{attrs:{id:"启动前端服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动前端服务"}},[t._v("#")]),t._v(" 启动前端服务")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ./ui-ngx\n \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" run start\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h2",{attrs:{id:"访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问"}},[t._v("#")]),t._v(" 访问")]),t._v(" "),a("p",[t._v("http://localhost:4200/")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("账号")]),t._v(" "),a("th",[t._v("密码")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("sysadmin@thingsboard.org")]),t._v(" "),a("td",[t._v("sysadmin")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424170610662.png",alt:"image-20240424170610662"}})]),t._v(" "),a("p",[t._v("可以直接切换到租户的页面，没有的话就新建就好了")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424172019960.png",alt:"image-20240424172019960"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424172034456.png",alt:"image-20240424172034456"}})]),t._v(" "),a("h2",{attrs:{id:"问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[t._v("#")]),t._v(" 问题")]),t._v(" "),a("h3",{attrs:{id:"编译过程问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译过程问题"}},[t._v("#")]),t._v(" 编译过程问题")]),t._v(" "),a("p",[t._v("1、Failed to execute goal com.github.eirslett:frontend-maven-plugin:1.12.0:yarn\n问题说明：thingsboard的UI下面pom文件中的npm和node版本，与本地安装的版本不匹配")]),t._v(" "),a("p",[t._v("解决方法：运行npm -v和node -v、yarn -v，查看已安装的node、npm、yarn版本，并将以下模块的pom文件中的npm和node版本替换掉")]),t._v(" "),a("ul",[a("li",[t._v("web-ui")]),t._v(" "),a("li",[t._v("js-executor")]),t._v(" "),a("li",[t._v("ui-ngx")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424114733901.png",alt:"image-20240424114733901"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424114924362.png",alt:"image-20240424114924362"}})]),t._v(" "),a("p",[t._v("2、protobuf插件")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("thingsboard"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("TransportProtos")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("* \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("解决方法：打开idea菜单： File->setting->plugins 搜索 proto*, 安装 GenProtobuf 插件, 并重启")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424115115788.png",alt:"image-20240424115115788"}})]),t._v(" "),a("p",[t._v("3、无效的标记: --release")]),t._v(" "),a("p",[t._v("问题说明：java编译器的jdk版本未指定到11导致")]),t._v(" "),a("p",[t._v("解决方法：将Preferences | Build, Execution, Deployment | Compiler | Java Compiler 中 project bytecode version选择11")]),t._v(" "),a("p",[t._v("4、Cannot resolve plugin org.thingsboard:gradle-maven-plugin:1.0.11")]),t._v(" "),a("p",[t._v("问题说明：因为依赖的包没有下载下来org.gradle:gradle-tooling-api:jar:7.1.1 was not found")]),t._v(" "),a("p",[t._v("解决方法：如果maven拉不下来，手动到https://developer.aliyun.com/mvn/search 下载jar以及pom.xml到仓库中")]),t._v(" "),a("h3",{attrs:{id:"ide配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ide配置"}},[t._v("#")]),t._v(" IDE配置")]),t._v(" "),a("p",[t._v("IDE使用的是idea。Maven使用的是idea自带的maven。将项目导入idea")]),t._v(" "),a("p",[t._v("1、指定JDK版本")]),t._v(" "),a("p",[t._v("包括platform的、项目的、module的、maven的、compile的。")]),t._v(" "),a("p",[t._v("2、安装插件")]),t._v(" "),a("p",[t._v("包括Protobuf相关插件、Lombok。一般Lombok插件都不会出现什么问题。这里说下Protobuf相关插件。\n可以选择使用Protocol Buffers")]),t._v(" "),a("p",[t._v("3、修改IDE属性")]),t._v(" "),a("p",[t._v("有个proto文件生成的java代码过大(TransportProtos)，默认是不会解析的。需要编辑ide的属性(Help-Edit Custom Properties)，加入idea.max.intellisense.filesize=5000将上限提高到5M")]),t._v(" "),a("p",[t._v("4、配置maven版本")]),t._v(" "),a("p",[t._v("使用3.6以上版本，个人安装的3.9.4版本")]),t._v(" "),a("h3",{attrs:{id:"启动问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动问题"}},[t._v("#")]),t._v(" 启动问题")]),t._v(" "),a("p",[t._v("1、Error running ThingsboardInstallApplication.Command line is too long.")]),t._v(" "),a("p",[t._v("解决办法为：")]),t._v(" "),a("p",[t._v("1.点击“Edit Configurations”")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424161340222.png",alt:"image-20240424161340222"}})]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("选择左侧的启动失败的项目，点击右侧“Modify options”")])]),t._v(" "),a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424161340222.png"}}),t._v(" "),a("p",[t._v("3.点击“shorten command line”")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424161443883.png",alt:"image-20240424161443883"}})]),t._v(" "),a("p",[t._v("4.Shorten command line选择“JAR manifest”，点击“Apply”生效即可")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424163308251.png",alt:"image-20240424163308251"}})]),t._v(" "),a("h3",{attrs:{id:"数据库问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库问题"}},[t._v("#")]),t._v(" 数据库问题")]),t._v(" "),a("p",[t._v("1、错误: 字段“datlastsysoid“不存在（Navicat报错）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20240424172234064.png",alt:"image-20240424172234064"}})]),t._v(" "),a("p",[t._v("解决办法，升级navicat到最新的版本")])])}),[],!1,null,null,null);a.default=r.exports}}]);