(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{421:function(t,a,s){"use strict";s.r(a);var e=s(8),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"三、mycat数据库中间件搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、mycat数据库中间件搭建"}},[t._v("#")]),t._v(" 三、mycat数据库中间件搭建")]),t._v(" "),a("p",[t._v("我们现在普遍的Java应用程序都是直接连接了MySQL软件进行读写操作，也就是我们在Java中的配置文件等定义了mysql的数据源，直接连接到了我们的")]),t._v(" "),a("p",[t._v("mysql软件，但是当某些情况下我们可能需要用到了多个数据库，这个时候我们可能就需要配多个数据源去连接我们的多个数据库，这个时候我们进行")]),t._v(" "),a("p",[t._v("sql操作的时候就会很麻烦，因为Java与数据库有了一个紧密的耦合度，但是如果我们在Java应用程序与mysql中间使用了mycat，我们只需要访问mycat")]),t._v(" "),a("p",[t._v("就可以了，至于数据源等问题，mycat会直接帮我们搞定。")]),t._v(" "),a("h2",{attrs:{id:"mycat下载地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mycat下载地址"}},[t._v("#")]),t._v(" mycat下载地址")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("https://github.com/MyCATApache/Mycat-download/tree/master/1.6.5-DEV\n\n# 官网地址\nhttp://www.mycat.org.cn/\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h2",{attrs:{id:"原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[t._v("#")]),t._v(" "),a("strong",[t._v("原理")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20221214155807553.png",alt:"image-20221214155807553"}})]),t._v(" "),a("p",[t._v("使用mycat进行主从切换，当一台mysql服务器宕机之后，mycat会切换至另一台进行连接，两台mysql互为主从，这样可以使两台mysql服务器互相备")]),t._v(" "),a("p",[t._v("份，使其数据一致。")]),t._v(" "),a("h2",{attrs:{id:"实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实战"}},[t._v("#")]),t._v(" 实战")]),t._v(" "),a("p",[t._v("mycat是基于java开发的，所以需要先安装jdk1.8")]),t._v(" "),a("h3",{attrs:{id:"下载mycat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载mycat"}},[t._v("#")]),t._v(" 下载mycat")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("https://github.com/MyCATApache/Mycat-download/tree/master/1.6.5-DEV\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20221214164143637.png",alt:"image-20221214164143637"}})]),t._v(" "),a("h3",{attrs:{id:"安装mycat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装mycat"}},[t._v("#")]),t._v(" 安装mycat")]),t._v(" "),a("p",[t._v("1、将下载到的包传输到linux服务器上的software上。")]),t._v(" "),a("p",[t._v("2、对压缩包进行解压。")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("tar -zxvf Mycat-server-1.6.5-DEV-20161231120132-linux.tar.gz\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("3、将mycat目录移动到 /usr/local下**(强制要求)**")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("mv mycat /usr/local\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("4、配置环境变量，vi ~/.bash_profile，增加以下 export")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("MYCAT_HOME=/usr/local/mycat\nexport PATH=$PATH:$MYCAT_HOME/bin\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("使配置文件生效")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("source ~/.bash_profile\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("5、配置连接信息")]),t._v(" "),a("p",[t._v("mycat的server.xml配置逻辑库的名称访问的账号密码")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<user name="root" defaultAccount="true">  \x3c!-- 这里是给虚拟库设定一个账号叫root，并且作为默认账号 --\x3e\n        <property name="password">123456</property>   \x3c!-- 账号root的密码 --\x3e\n        <property name="schemas">aiurt-platform</property>   \x3c!-- 账号root对应的虚拟库,这个库保持默认比较好 --\x3e\n</user>\n<user name="test">                                   \x3c!-- 这里是给虚拟库设定一个账号叫test，并且作为默认账号 --\x3e\n        <property name="password">123456</property>    \x3c!-- 账号test的密码 --\x3e\n        <property name="schemas">aiurt-platform</property>   \x3c!-- 账号test对应的虚拟库,这个库保持默认比较好 --\x3e\n        <property name="readOnly">true</property>    \x3c!-- 说明这个账号是只读账号 --\x3e\n</user>\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("6、配置真实数据库信息")]),t._v(" "),a("p",[t._v("打开"),a("code",[t._v("schema.xml")]),t._v("，编辑如下地方：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('\x3c!--schema定义逻辑库的标签,配置逻辑库 name：表示逻辑库的名称  dataNode表示逻辑库关联的节点名称 --\x3e\n<schema name="aiurt-platform" checkSQLschema="false" sqlMaxLimit="100" dataNode="dn1"></schema>\n     \x3c!-- dataNode表示定义数据节点的标签 name：节点名称，必须和上面schema的dataNode值保持一致  dataHost关联的主机名称\n\t database=表示真实数据库的名称--\x3e\n\t<dataNode name="dn1" dataHost="localhost1" database="aiurt-platform" />\n\t\x3c!-- 定义真是服务所在的地址 name：表示数据主机的名称  --\x3e\n\t<dataHost name="localhost1" maxCon="1000" minCon="10" balance="1"\n\t\t\t  writeType="0" dbType="mysql" dbDriver="native" switchType="1"  slaveThreshold="100">\n\t\t\x3c!-- 定义真是服务所在的地址 name：表示数据主机的名称  --\x3e\n\t\t<heartbeat>select user()</heartbeat>\n\t\t\x3c!-- 配置主节点的信息 host随便起--\x3e\n\t\t<writeHost host="hostM1" url="192.168.1.27:9088" user="root" password="123456">\n\t\t  \x3c!-- 配置读节点的信息 可以配置多个--\x3e\n\t\t\t<readHost host="hostS1" url="192.168.1.27:9088" user="root" password="123456" />\n\t\t</writeHost>\n\t\t<writeHost host="hostM2" url="192.168.1.27:9089" user="root" password="123456" />\n\t\t  \x3c!-- 配置读节点的信息 可以配置多个--\x3e\n\t\t\t<readHost host="hostS2" url="192.168.1.27:9089" user="root" password="123456" />\n\t\t</writeHost>\n\t</dataHost>\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br")])]),a("p",[a("strong",[t._v("参数说明：")])]),t._v(" "),a("p",[a("code",[t._v("schema")]),t._v(":"),a("code",[t._v("name")]),t._v("属性是自定义的  dataNode表示数据库的节点信息  dn1表示逻辑库")]),t._v(" "),a("p",[a("code",[t._v("datahost")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('&lt;!--参数介绍--\x3e\n\t\t&lt;!--balance 0表示所有的读操作都会发往writeHost主机 --\x3e  \n\t\t&lt;!--1表示所有的读操作发往readHost和闲置的主节点中--\x3e\n\t\t&lt;!--writeType=0 所有的写操作都发往第一个writeHost主机，当第一个writeHost宕机时，切换到第二个writeHost--\x3e\t\n\t\t&lt;!--writeType=1 所有的写操作随机发往writeHost中--\x3e\n\t\t&lt;!--dbType 表示数据库类型 mysql/oracle--\x3e\n\t\t&lt;!--dbDriver="native"  固定参数 不变--\x3e\n\t\t&lt;!--switchType=-1 表示不自动切换, 主机宕机后不会自动切换从节点--\x3e\n\t\t&lt;!--switchType=1  表示会自动切换(默认值)如果第一个主节点宕机后,Mycat会进行3次心跳检测,如果3次都没有响应,则会自动切换到第二个主节点--\x3e\n\t\t&lt;!--并且会更新/conf/dnindex.properties文件的主节点信息 localhost1=0 表示第一个节点.该文件不要随意修改否则会出现大问题--\x3e\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("7、启动mycat")]),t._v(" "),a("p",[t._v("检查好格式并保存之后，就到 mycat 目录下的/bin/里"),a("code",[t._v("./mycat start")]),t._v("就启动 mycat 了。启动成功之后，8066 和 9066 都是被监听的，如图")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20221214165120918.png",alt:"image-20221214165120918"}})]),t._v(" "),a("h3",{attrs:{id:"启动故障排错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动故障排错"}},[t._v("#")]),t._v(" 启动故障排错")]),t._v(" "),a("p",[t._v("如果启动 mycat 失败，可以去 logs 文件夹里看日志.")]),t._v(" "),a("h3",{attrs:{id:"验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[t._v("#")]),t._v(" 验证")]),t._v(" "),a("p",[t._v("使用navicat软件连接到mycat虚拟库")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# mysql的端口号默认为8066，所以我们连接的时候也需要把端口写成8066\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("通过后台服务连接到mycat后，通关postman访问某个接口，此时可以从mycat.log这个文件日志中看出，该条sql走的是哪个数据库的。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20221215103847319.png",alt:"image-20221215103847319"}})])])}),[],!1,null,null,null);a.default=r.exports}}]);