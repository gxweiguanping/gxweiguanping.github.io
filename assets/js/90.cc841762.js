(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{420:function(s,a,t){"use strict";t.r(a);var e=t(8),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"二、mysql主从复制搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、mysql主从复制搭建"}},[s._v("#")]),s._v(" 二、mysql主从复制搭建")]),s._v(" "),a("h2",{attrs:{id:"整体架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体架构"}},[s._v("#")]),s._v(" 整体架构")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20221216142535184.png",alt:"image-20221216142535184"}})]),s._v(" "),a("h2",{attrs:{id:"原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[s._v("#")]),s._v(" 原理")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20221213114549605.png",alt:"image-20221213114549605"}})]),s._v(" "),a("p",[s._v("1、主库会生成一个 log dump 线程,用来给从库 I/O 线程传 Binlog 数据。")]),s._v(" "),a("p",[s._v("2、从库的 I/O 线程会去请求主库的 Binlog，并将得到的 Binlog 写到本地的 relay log (中继日志)文件中。")]),s._v(" "),a("p",[s._v("3、SQL 线程,会读取 relay log 文件中的日志，并解析成 SQL 语句逐一执行。")]),s._v(" "),a("p",[a("strong",[s._v("主从复制用途")])]),s._v(" "),a("p",[s._v("1） 实时灾备，用于故障切换（高可用）")]),s._v(" "),a("p",[s._v("2） 读写分离，提供查询服务（读扩展）")]),s._v(" "),a("p",[s._v("3） 数据备份，避免影响业务（高可用）")]),s._v(" "),a("p",[a("strong",[s._v("疑问：")])]),s._v(" "),a("p",[s._v("为什么要先写一遍relay log然后再写从库，直接将数据写入到从库不好吗？ 在这里relay log的作用就类似于一个中间层，主库是多线程并发写的，从库")]),s._v(" "),a("p",[s._v("的sql线程是单线程串行执行的，所以这两边的生产和消费速度肯定不同。当主库发的binlog消息过多时，从库的relay log可以起到暂存主库数据的作")]),s._v(" "),a("p",[s._v("用，接着从库的sql线程再慢慢消费这些relay log数据，这样既不会限制主库发消息的速度，也不会给从库造成过大压力。")]),s._v(" "),a("h2",{attrs:{id:"实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实战"}},[s._v("#")]),s._v(" 实战")]),s._v(" "),a("p",[a("strong",[s._v("主从部署必要条件")])]),s._v(" "),a("p",[s._v("1） 从库服务器能连通主库")]),s._v(" "),a("p",[s._v("2） 主库开启binlog日志（设置log-bin参数）")]),s._v(" "),a("p",[s._v("3） 主从server-id不同")]),s._v(" "),a("p",[s._v("我们需要准备两台mysql，我这里使用docker，那么我就需要开启两个mysql容器就好了。docker安装mysql自行查找资料。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 主库\ndocker run -p 9088:3306 --name mysql_master -v /docker/mysql_master/conf:/etc/mysql/conf.d -v /docker/mysql_master/logs:/logs -v /docker/mysql_master/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7\n\n# 从库\ndocker run -p 9089:3306 --name mysql_from -v /docker/mysql_from/conf:/etc/mysql/conf.d -v /docker/mysql_from/logs:/logs -v /docker/mysql_from/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("如果安装的是mysql8那么需要多加一个启动参数：--privileged=true")]),s._v(" "),a("p",[s._v("用于在启动容器时赋予它一些额外的权限。在默认情况下，Docker容器是在一个受限的环境中运行的，它们不能访问宿主机的所有资源。然而，有时候，你可能需要让容器能够访问更多的系统资源或执行一些特殊的系统调用。")])]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("--lower-case-table-names=1在首次启动的时候就需要加上")]),s._v(" "),a("p",[s._v("如果忘记加上，那么必须新建映射的data目录的（/docker/mysql_master/data）")])]),s._v(" "),a("p",[s._v("mysql8")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run  \n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9088")]),s._v(":3306 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" mysql_master "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /docker/mysql_master/conf:/etc/mysql/conf.d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /docker/mysql_master/logs:/logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /docker/mysql_master/data:/var/lib/mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" mysql:8.0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--lower-case-table-names"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run  \n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9089")]),s._v(":3306 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" mysql_from "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /docker/mysql_from/conf:/etc/mysql/conf.d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /docker/mysql_from/logs:/logs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /docker/mysql_from/data:/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" mysql:8.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--lower-case-table-names"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("h3",{attrs:{id:"_1、准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、准备"}},[s._v("#")]),s._v(" 1、准备")]),s._v(" "),a("p",[s._v("mysql：8.0")]),s._v(" "),a("p",[s._v("docker")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("主库ip")]),s._v(" "),a("th",[s._v("192.168.1.27")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("端口")]),s._v(" "),a("td",[s._v("9088")])]),s._v(" "),a("tr",[a("td",[s._v("账号")]),s._v(" "),a("td",[s._v("root")])]),s._v(" "),a("tr",[a("td",[s._v("密码")]),s._v(" "),a("td",[s._v("123456")])])])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("从库ip")]),s._v(" "),a("th",[s._v("192.168.1.27")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("端口")]),s._v(" "),a("td",[s._v("9089")])]),s._v(" "),a("tr",[a("td",[s._v("账号")]),s._v(" "),a("td",[s._v("root")])]),s._v(" "),a("tr",[a("td",[s._v("密码")]),s._v(" "),a("td",[s._v("123456")])])])]),s._v(" "),a("p",[a("strong",[s._v("做同步之前要保证两个数据库数据一致.")])]),s._v(" "),a("p",[s._v("如果主数据库有数据的话。 数据库锁表操作，不让数据再进行写入动作。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 操作之前执行\nmysql> FLUSH TABLES WITH READ LOCK;\n\n# 开启同步之前执行\nmysql> UNLOCK TABLES;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_2、配置主服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、配置主服务器"}},[s._v("#")]),s._v(" 2、配置主服务器")]),s._v(" "),a("h4",{attrs:{id:"配置主服务器的-my-cnf-添加以下内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置主服务器的-my-cnf-添加以下内容"}},[s._v("#")]),s._v(" 配置主服务器的 my.cnf 添加以下内容：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[mysqld]\n## 同一局域网内注意要唯一\nserver-id=88\n## 开启二进制日志功能\nlog-bin=mysql-bin\nsql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'\nngram_token_size=2\ninnodb_ft_min_token_size=1\nft_min_word_len=1\n## GROUP_CONCAT函数的长度\ngroup_concat_max_len=4294967295\n\nauto-increment-increment = 2\nauto-increment-offset = 1\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[a("strong",[s._v("配置解释：")])]),s._v(" "),a("p",[s._v("server-id：标识，唯一，值范围在：1至2^23-1")]),s._v(" "),a("p",[s._v("log-bin：配置是否在数据库有变动时写二进制日志")]),s._v(" "),a("p",[s._v("lower_case_table_names：忽略大小写")]),s._v(" "),a("p",[a("strong",[s._v("auto_increment_offset")]),s._v("和"),a("strong",[s._v("auto_increment_increment")]),s._v("：当同步断开，两台服务器分别有新数据进入，那么主键ID是自增长列会出现冲突的情况，会导致同步无法继续。加上上面两个设置后server1的auto_increment字段产生的数值是：1, 3, 5, 7, …等奇数，server2的为偶数。")]),s._v(" "),a("h4",{attrs:{id:"重启主服务mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启主服务mysql"}},[s._v("#")]),s._v(" 重启主服务mysql")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" service mysql restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"查看-skip-networking-的状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看-skip-networking-的状态"}},[s._v("#")]),s._v(" 查看 skip_networking 的状态")]),s._v(" "),a("p",[s._v("确保在主服务器上 skip_networking 选项处于 OFF 关闭状态, 这是默认值。如果是启用的，则从站无法与主站通信，并且复制失败。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mysql> show variables like '%skip_networking%';\n+-----------------+-------+\n| Variable_name   | Value |\n+-----------------+-------+\n| skip_networking | OFF   |\n+-----------------+-------+\n1 row in set (0.00 sec)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"创建一个专门用来复制的用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建一个专门用来复制的用户"}},[s._v("#")]),s._v(" 创建一个专门用来复制的用户")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE USER 'repl'@'%' identified by '123456';\n\nGRANT REPLICATION SLAVE ON *.*  TO  'repl'@'%';\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"在主服务器配置连接到从服务器的相关信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在主服务器配置连接到从服务器的相关信息"}},[s._v("#")]),s._v(" 在主服务器配置连接到从服务器的相关信息")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CHANGE MASTER TO MASTER_HOST='192.168.1.27', MASTER_PORT=9089,MASTER_USER='repl',MASTER_PASSWORD='123456',master_log_file='mysql-bin.000001',master_log_pos=154;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("master_log_file和master_log_pos需要在从服务器上查看后，根据实际情况修改。")])]),s._v(" "),a("p",[s._v("在从服务器上执行：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("show master status;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20221213112600625.png",alt:"image-20221213112600625"}})]),s._v(" "),a("h3",{attrs:{id:"_3、配置从服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、配置从服务器"}},[s._v("#")]),s._v(" 3、配置从服务器")]),s._v(" "),a("h4",{attrs:{id:"配置从服务器的-my-cnf-添加以下内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置从服务器的-my-cnf-添加以下内容"}},[s._v("#")]),s._v(" 配置从服务器的 my.cnf 添加以下内容：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[mysqld]\n## 同一局域网内注意要唯一\nserver-id=89\n## 开启二进制日志功能\nlog-bin=mysql-bin\nlower_case_table_names=1\nsql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'\nngram_token_size=2\ninnodb_ft_min_token_size=1\nft_min_word_len=1\ngroup_concat_max_len=4294967295\n\nauto-increment-increment = 2\nauto-increment-offset = 2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("配置解释：")]),s._v(" "),a("p",[s._v("**server-id：**标识，唯一，值范围在：1至2^23-1")]),s._v(" "),a("p",[s._v("**log-bin：**配置是否在数据库有变动时写二进制日志")]),s._v(" "),a("p",[s._v("**lower_case_table_names：**忽略大小写")]),s._v(" "),a("p",[a("strong",[s._v("auto_increment_offset")]),s._v("和"),a("strong",[s._v("auto_increment_increment")]),s._v("：当同步断开，两台服务器分别有新数据进入，那么主键ID是自增长列会出现冲突的情况，会导致同步无法继续。加上上面两个设置后server1的auto_increment字段产生的数值是：1, 3, 5, 7, …等奇数，server2的为偶数。")]),s._v(" "),a("h4",{attrs:{id:"重启从服务mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启从服务mysql"}},[s._v("#")]),s._v(" 重启从服务mysql")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" service mysql restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"创建一个专门用来复制的用户-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建一个专门用来复制的用户-2"}},[s._v("#")]),s._v(" 创建一个专门用来复制的用户")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE USER 'repl'@'%' identified by '123456';\n\nGRANT REPLICATION SLAVE ON *.*  TO  'repl'@'%';\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"在从服务器配置连接到主服务器的相关信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在从服务器配置连接到主服务器的相关信息"}},[s._v("#")]),s._v(" 在从服务器配置连接到主服务器的相关信息")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CHANGE MASTER TO MASTER_HOST='192.168.1.27', MASTER_PORT=9088,MASTER_USER='repl',MASTER_PASSWORD='123456',master_log_file='mysql-bin.000002',master_log_pos=154;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("注意：master_log_file和master_log_pos需要在从服务器上查看后更换。")]),s._v(" "),a("p",[a("code",[s._v("在主服务器上执行：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("show master status;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20221213112852370.png",alt:"image-20221213112852370"}})]),s._v(" "),a("h3",{attrs:{id:"_4、主库和从库启动同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、主库和从库启动同步"}},[s._v("#")]),s._v(" 4、主库和从库启动同步")]),s._v(" "),a("p",[s._v("主库和从库先后执行")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mysql> start slave;\nQuery OK, 0 rows affected (0.00 sec)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("注意：如果想关闭同步，则可以使用（这一步不是必须的）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mysql> stop slave;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_5、查看同步状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、查看同步状态"}},[s._v("#")]),s._v(" 5、查看同步状态")]),s._v(" "),a("h4",{attrs:{id:"主库mysql同步状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主库mysql同步状态"}},[s._v("#")]),s._v(" 主库mysql同步状态")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mysql>  show slave status \\G;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20221213113308906.png",alt:"image-20221213113308906"}})]),s._v(" "),a("h4",{attrs:{id:"从库mysql同步状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从库mysql同步状态"}},[s._v("#")]),s._v(" 从库mysql同步状态")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mysql>  show slave status \\G;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20221213113427067.png",alt:"image-20221213113427067"}})]),s._v(" "),a("h3",{attrs:{id:"_6、测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、测试"}},[s._v("#")]),s._v(" 6、测试")]),s._v(" "),a("p",[s._v("1、在主库新建表后，去从库查看是否同步，如果有对应的表就说明成功了")]),s._v(" "),a("p",[s._v("2、在从库的一张表插入数据后，去主库的对应的表查看，如果有对应的数据就说明成功了")]),s._v(" "),a("h2",{attrs:{id:"问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),a("h3",{attrs:{id:"异步复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异步复制"}},[s._v("#")]),s._v(" 异步复制")]),s._v(" "),a("p",[s._v("1、逻辑上")]),s._v(" "),a("p",[s._v("MySQL默认的复制即是异步的，主库在执行完客户端提交的事务后会立即将结果返给给客户端，并不关心从库是否已经接收并处理，这样就会有一个问题，主如果挂掉了，此时主上已经提交的事务可能并没有传到从库上，如果此时，强行将从提升为主，可能导致新主上的数据不完整。")]),s._v(" "),a("p",[s._v("2、技术上")]),s._v(" "),a("p",[s._v("主库将事务 Binlog 事件写入到 Binlog 文件中，此时主库只会通知一下 Dump 线程发送这些新的 Binlog，然后主库就会继续处理提交操作，而此时不会保证这些 Binlog 传到任何一个从库节点上。")]),s._v(" "),a("p",[s._v("3、原理图")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/studentgitee/note-picture/raw/master/image-20221213114549605.png",alt:"image-20221213114549605"}})]),s._v(" "),a("h3",{attrs:{id:"并行复制-全同步复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#并行复制-全同步复制"}},[s._v("#")]),s._v(" 并行复制（全同步复制）")]),s._v(" "),a("p",[s._v("1、逻辑上")]),s._v(" "),a("p",[s._v("指当主库执行完一个事务，所有的从库都执行了该事务才返回给客户端。因为需要等待所有从库执行完该事务才能返回，所以全同步复制的性能必然会收到严重的影响。")]),s._v(" "),a("h3",{attrs:{id:"半同步复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#半同步复制"}},[s._v("#")]),s._v(" "),a("strong",[s._v("半同步复制")])]),s._v(" "),a("p",[s._v("1、逻辑上")]),s._v(" "),a("p",[s._v("是介于并行复制与异步复制之间的一种，主库只需要等待至少一个从库节点收到并且 Flush Binlog 到 Relay Log 文件即可，主库不需要等待所有从库给")]),s._v(" "),a("p",[s._v("主库反馈。同时，这里只是一个收到的反馈，而不是已经完全完成并且提交的反馈，如此，节省了很多时间。")])])}),[],!1,null,null,null);a.default=r.exports}}]);