<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Security | Gpingの知识库</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="记录学习路上的点点滴滴">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer">
    
    <link rel="preload" href="/assets/css/0.styles.18a91880.css" as="style"><link rel="preload" href="/assets/js/app.57e44612.js" as="script"><link rel="preload" href="/assets/js/2.ea24d1ee.js" as="script"><link rel="preload" href="/assets/js/60.5946ddf4.js" as="script"><link rel="prefetch" href="/assets/js/10.87a7fc9a.js"><link rel="prefetch" href="/assets/js/100.1dde94ac.js"><link rel="prefetch" href="/assets/js/101.a9e60cd0.js"><link rel="prefetch" href="/assets/js/102.41fc30c1.js"><link rel="prefetch" href="/assets/js/103.d66d2d71.js"><link rel="prefetch" href="/assets/js/104.22cb586e.js"><link rel="prefetch" href="/assets/js/105.2e7087a4.js"><link rel="prefetch" href="/assets/js/106.f3ea04f4.js"><link rel="prefetch" href="/assets/js/107.1fe76475.js"><link rel="prefetch" href="/assets/js/108.5419a3bf.js"><link rel="prefetch" href="/assets/js/109.25f5a5d7.js"><link rel="prefetch" href="/assets/js/11.04f09971.js"><link rel="prefetch" href="/assets/js/110.859d6308.js"><link rel="prefetch" href="/assets/js/111.1007812c.js"><link rel="prefetch" href="/assets/js/112.1e3ac86b.js"><link rel="prefetch" href="/assets/js/113.39632362.js"><link rel="prefetch" href="/assets/js/114.cd109b57.js"><link rel="prefetch" href="/assets/js/115.738c1531.js"><link rel="prefetch" href="/assets/js/116.8afaf129.js"><link rel="prefetch" href="/assets/js/117.fc53579f.js"><link rel="prefetch" href="/assets/js/118.21a1f8c4.js"><link rel="prefetch" href="/assets/js/119.0a6295f3.js"><link rel="prefetch" href="/assets/js/12.39c155f1.js"><link rel="prefetch" href="/assets/js/120.b52ae2c0.js"><link rel="prefetch" href="/assets/js/121.a7d78631.js"><link rel="prefetch" href="/assets/js/122.a28e6a23.js"><link rel="prefetch" href="/assets/js/123.c426392a.js"><link rel="prefetch" href="/assets/js/124.c522482b.js"><link rel="prefetch" href="/assets/js/125.92a0ca2c.js"><link rel="prefetch" href="/assets/js/126.c7e332fc.js"><link rel="prefetch" href="/assets/js/127.09fed274.js"><link rel="prefetch" href="/assets/js/128.5b2b776f.js"><link rel="prefetch" href="/assets/js/129.78e15024.js"><link rel="prefetch" href="/assets/js/13.2b02d3de.js"><link rel="prefetch" href="/assets/js/130.97b2a44d.js"><link rel="prefetch" href="/assets/js/131.0453b852.js"><link rel="prefetch" href="/assets/js/132.1d3bd373.js"><link rel="prefetch" href="/assets/js/133.445fa178.js"><link rel="prefetch" href="/assets/js/134.10a04df0.js"><link rel="prefetch" href="/assets/js/135.7966ce33.js"><link rel="prefetch" href="/assets/js/136.03b5e675.js"><link rel="prefetch" href="/assets/js/137.5eed4831.js"><link rel="prefetch" href="/assets/js/138.ed4fba77.js"><link rel="prefetch" href="/assets/js/139.8eb46152.js"><link rel="prefetch" href="/assets/js/14.8881736c.js"><link rel="prefetch" href="/assets/js/140.08e196c0.js"><link rel="prefetch" href="/assets/js/141.b18b66b6.js"><link rel="prefetch" href="/assets/js/142.03a0879c.js"><link rel="prefetch" href="/assets/js/143.22fdbb7b.js"><link rel="prefetch" href="/assets/js/144.31189f97.js"><link rel="prefetch" href="/assets/js/145.75b2fd40.js"><link rel="prefetch" href="/assets/js/146.dbb475d1.js"><link rel="prefetch" href="/assets/js/147.cf107953.js"><link rel="prefetch" href="/assets/js/148.f9449ca9.js"><link rel="prefetch" href="/assets/js/149.6960a659.js"><link rel="prefetch" href="/assets/js/15.b4b6d9e8.js"><link rel="prefetch" href="/assets/js/150.f4a4a9e2.js"><link rel="prefetch" href="/assets/js/151.df5e1fda.js"><link rel="prefetch" href="/assets/js/152.b3ebe11a.js"><link rel="prefetch" href="/assets/js/153.fe7d6b3f.js"><link rel="prefetch" href="/assets/js/154.aeb16b2b.js"><link rel="prefetch" href="/assets/js/155.649eeac2.js"><link rel="prefetch" href="/assets/js/156.72888c77.js"><link rel="prefetch" href="/assets/js/157.dc67f246.js"><link rel="prefetch" href="/assets/js/158.467b9e3c.js"><link rel="prefetch" href="/assets/js/159.384e3132.js"><link rel="prefetch" href="/assets/js/16.e6a03cb0.js"><link rel="prefetch" href="/assets/js/160.75f72beb.js"><link rel="prefetch" href="/assets/js/161.c4bf3ed6.js"><link rel="prefetch" href="/assets/js/162.4e905989.js"><link rel="prefetch" href="/assets/js/163.e10e10ec.js"><link rel="prefetch" href="/assets/js/164.8c3e42dc.js"><link rel="prefetch" href="/assets/js/165.c9509c25.js"><link rel="prefetch" href="/assets/js/166.875c96b9.js"><link rel="prefetch" href="/assets/js/167.ac323741.js"><link rel="prefetch" href="/assets/js/168.6cff22a8.js"><link rel="prefetch" href="/assets/js/169.9a12d5c9.js"><link rel="prefetch" href="/assets/js/17.430c4645.js"><link rel="prefetch" href="/assets/js/170.bb307927.js"><link rel="prefetch" href="/assets/js/171.40dbf2b6.js"><link rel="prefetch" href="/assets/js/172.a11d0b5a.js"><link rel="prefetch" href="/assets/js/173.86064fd6.js"><link rel="prefetch" href="/assets/js/174.1cacb422.js"><link rel="prefetch" href="/assets/js/175.622de80a.js"><link rel="prefetch" href="/assets/js/176.de8449aa.js"><link rel="prefetch" href="/assets/js/177.cb9b484d.js"><link rel="prefetch" href="/assets/js/178.9f5c2068.js"><link rel="prefetch" href="/assets/js/179.ffff651e.js"><link rel="prefetch" href="/assets/js/18.3bb48241.js"><link rel="prefetch" href="/assets/js/180.09a9c21e.js"><link rel="prefetch" href="/assets/js/181.26ed76ed.js"><link rel="prefetch" href="/assets/js/182.17a77c05.js"><link rel="prefetch" href="/assets/js/183.53fafefd.js"><link rel="prefetch" href="/assets/js/184.a67c9279.js"><link rel="prefetch" href="/assets/js/185.5ef13915.js"><link rel="prefetch" href="/assets/js/186.80f2394f.js"><link rel="prefetch" href="/assets/js/187.9966ad44.js"><link rel="prefetch" href="/assets/js/188.03ff6401.js"><link rel="prefetch" href="/assets/js/189.0673741c.js"><link rel="prefetch" href="/assets/js/19.1a1d4b97.js"><link rel="prefetch" href="/assets/js/190.b00a4558.js"><link rel="prefetch" href="/assets/js/191.ffb3dc84.js"><link rel="prefetch" href="/assets/js/192.a1c08248.js"><link rel="prefetch" href="/assets/js/193.12c63e53.js"><link rel="prefetch" href="/assets/js/194.f33b52de.js"><link rel="prefetch" href="/assets/js/195.33c636d4.js"><link rel="prefetch" href="/assets/js/196.6c3d5dd1.js"><link rel="prefetch" href="/assets/js/197.30d1c025.js"><link rel="prefetch" href="/assets/js/198.452ad7b8.js"><link rel="prefetch" href="/assets/js/199.e5ef0a61.js"><link rel="prefetch" href="/assets/js/20.a60725d3.js"><link rel="prefetch" href="/assets/js/200.686c1f4c.js"><link rel="prefetch" href="/assets/js/201.bc89ccf8.js"><link rel="prefetch" href="/assets/js/202.59ba3183.js"><link rel="prefetch" href="/assets/js/203.bcd865f8.js"><link rel="prefetch" href="/assets/js/204.8d50c324.js"><link rel="prefetch" href="/assets/js/205.742dccae.js"><link rel="prefetch" href="/assets/js/206.88d6037a.js"><link rel="prefetch" href="/assets/js/207.190776c5.js"><link rel="prefetch" href="/assets/js/208.fa870ec7.js"><link rel="prefetch" href="/assets/js/209.0ead087a.js"><link rel="prefetch" href="/assets/js/21.6c56b6f5.js"><link rel="prefetch" href="/assets/js/210.4793eafd.js"><link rel="prefetch" href="/assets/js/211.d4701451.js"><link rel="prefetch" href="/assets/js/212.960f82e6.js"><link rel="prefetch" href="/assets/js/213.06afd767.js"><link rel="prefetch" href="/assets/js/214.7b98451d.js"><link rel="prefetch" href="/assets/js/215.78151312.js"><link rel="prefetch" href="/assets/js/216.d2f394e3.js"><link rel="prefetch" href="/assets/js/217.d6868358.js"><link rel="prefetch" href="/assets/js/218.74bb756c.js"><link rel="prefetch" href="/assets/js/219.6239b512.js"><link rel="prefetch" href="/assets/js/22.f0aec2af.js"><link rel="prefetch" href="/assets/js/220.18943948.js"><link rel="prefetch" href="/assets/js/221.952b0093.js"><link rel="prefetch" href="/assets/js/222.908dcde3.js"><link rel="prefetch" href="/assets/js/223.ccc9ca97.js"><link rel="prefetch" href="/assets/js/224.97bb1b38.js"><link rel="prefetch" href="/assets/js/225.f44d9991.js"><link rel="prefetch" href="/assets/js/226.0cbe1043.js"><link rel="prefetch" href="/assets/js/227.0ef2d9fa.js"><link rel="prefetch" href="/assets/js/228.08e2a12e.js"><link rel="prefetch" href="/assets/js/229.9d76c3da.js"><link rel="prefetch" href="/assets/js/23.b75f4ad8.js"><link rel="prefetch" href="/assets/js/230.0130ed60.js"><link rel="prefetch" href="/assets/js/231.cc7bfe6a.js"><link rel="prefetch" href="/assets/js/232.945b8961.js"><link rel="prefetch" href="/assets/js/233.b92a416e.js"><link rel="prefetch" href="/assets/js/234.1e603d6c.js"><link rel="prefetch" href="/assets/js/235.2cbbf26a.js"><link rel="prefetch" href="/assets/js/236.8c2d0914.js"><link rel="prefetch" href="/assets/js/237.6d37c843.js"><link rel="prefetch" href="/assets/js/238.328bfb17.js"><link rel="prefetch" href="/assets/js/239.3cfc2492.js"><link rel="prefetch" href="/assets/js/24.2f8e45fa.js"><link rel="prefetch" href="/assets/js/240.49c464d7.js"><link rel="prefetch" href="/assets/js/241.a117b6ed.js"><link rel="prefetch" href="/assets/js/242.f755edbf.js"><link rel="prefetch" href="/assets/js/243.d465b990.js"><link rel="prefetch" href="/assets/js/244.437ddc10.js"><link rel="prefetch" href="/assets/js/245.2e779b62.js"><link rel="prefetch" href="/assets/js/246.833a9e59.js"><link rel="prefetch" href="/assets/js/247.3642921c.js"><link rel="prefetch" href="/assets/js/248.6fe5d428.js"><link rel="prefetch" href="/assets/js/249.11831ea9.js"><link rel="prefetch" href="/assets/js/25.b05b892c.js"><link rel="prefetch" href="/assets/js/250.8c3ef99e.js"><link rel="prefetch" href="/assets/js/251.520e04bc.js"><link rel="prefetch" href="/assets/js/252.b091ccdc.js"><link rel="prefetch" href="/assets/js/253.b763e62c.js"><link rel="prefetch" href="/assets/js/254.4d336e26.js"><link rel="prefetch" href="/assets/js/255.5d47d641.js"><link rel="prefetch" href="/assets/js/256.baa3ebe3.js"><link rel="prefetch" href="/assets/js/257.2ffae9af.js"><link rel="prefetch" href="/assets/js/258.c604142e.js"><link rel="prefetch" href="/assets/js/259.e74e6cd6.js"><link rel="prefetch" href="/assets/js/26.8ba653c3.js"><link rel="prefetch" href="/assets/js/260.7b310562.js"><link rel="prefetch" href="/assets/js/261.e3b096df.js"><link rel="prefetch" href="/assets/js/262.808f799f.js"><link rel="prefetch" href="/assets/js/263.c560074f.js"><link rel="prefetch" href="/assets/js/264.a46a2877.js"><link rel="prefetch" href="/assets/js/265.d15875dc.js"><link rel="prefetch" href="/assets/js/266.44ad46e6.js"><link rel="prefetch" href="/assets/js/267.744591cc.js"><link rel="prefetch" href="/assets/js/268.b63a806f.js"><link rel="prefetch" href="/assets/js/269.2df63b7b.js"><link rel="prefetch" href="/assets/js/27.2649684b.js"><link rel="prefetch" href="/assets/js/270.96a1e8da.js"><link rel="prefetch" href="/assets/js/271.f7f48faf.js"><link rel="prefetch" href="/assets/js/272.89f1f9b3.js"><link rel="prefetch" href="/assets/js/273.9db895c8.js"><link rel="prefetch" href="/assets/js/28.04ba17fc.js"><link rel="prefetch" href="/assets/js/29.fc9bec6b.js"><link rel="prefetch" href="/assets/js/3.ebf0a2ca.js"><link rel="prefetch" href="/assets/js/30.8f6c8682.js"><link rel="prefetch" href="/assets/js/31.044a932c.js"><link rel="prefetch" href="/assets/js/32.f86a299c.js"><link rel="prefetch" href="/assets/js/33.69f05cd0.js"><link rel="prefetch" href="/assets/js/34.0fcfdfd2.js"><link rel="prefetch" href="/assets/js/35.fbba2378.js"><link rel="prefetch" href="/assets/js/36.b8c83634.js"><link rel="prefetch" href="/assets/js/37.af10d35c.js"><link rel="prefetch" href="/assets/js/38.40c50958.js"><link rel="prefetch" href="/assets/js/39.048effca.js"><link rel="prefetch" href="/assets/js/4.910990f1.js"><link rel="prefetch" href="/assets/js/40.34df2e9c.js"><link rel="prefetch" href="/assets/js/41.0d92c05d.js"><link rel="prefetch" href="/assets/js/42.7d55e3eb.js"><link rel="prefetch" href="/assets/js/43.784d6526.js"><link rel="prefetch" href="/assets/js/44.ab75d220.js"><link rel="prefetch" href="/assets/js/45.1da53631.js"><link rel="prefetch" href="/assets/js/46.2bc19c98.js"><link rel="prefetch" href="/assets/js/47.ebb349e1.js"><link rel="prefetch" href="/assets/js/48.4c790e5f.js"><link rel="prefetch" href="/assets/js/49.a08ffcbf.js"><link rel="prefetch" href="/assets/js/5.1a4306f1.js"><link rel="prefetch" href="/assets/js/50.2a986267.js"><link rel="prefetch" href="/assets/js/51.b6e6ae81.js"><link rel="prefetch" href="/assets/js/52.884f6499.js"><link rel="prefetch" href="/assets/js/53.21026904.js"><link rel="prefetch" href="/assets/js/54.da32fcd7.js"><link rel="prefetch" href="/assets/js/55.8b53dfa1.js"><link rel="prefetch" href="/assets/js/56.f61d102d.js"><link rel="prefetch" href="/assets/js/57.f4da3322.js"><link rel="prefetch" href="/assets/js/58.5e3282e7.js"><link rel="prefetch" href="/assets/js/59.a84fd4f0.js"><link rel="prefetch" href="/assets/js/6.051801a8.js"><link rel="prefetch" href="/assets/js/61.18c749ab.js"><link rel="prefetch" href="/assets/js/62.da684abf.js"><link rel="prefetch" href="/assets/js/63.2b0fa974.js"><link rel="prefetch" href="/assets/js/64.2f400a86.js"><link rel="prefetch" href="/assets/js/65.4cf2386f.js"><link rel="prefetch" href="/assets/js/66.188c4b33.js"><link rel="prefetch" href="/assets/js/67.b4f824ac.js"><link rel="prefetch" href="/assets/js/68.d77410fc.js"><link rel="prefetch" href="/assets/js/69.6e24eb76.js"><link rel="prefetch" href="/assets/js/7.8cdfab2f.js"><link rel="prefetch" href="/assets/js/70.5ca51a92.js"><link rel="prefetch" href="/assets/js/71.35d7ed60.js"><link rel="prefetch" href="/assets/js/72.a7853bf5.js"><link rel="prefetch" href="/assets/js/73.a891df77.js"><link rel="prefetch" href="/assets/js/74.e978df7f.js"><link rel="prefetch" href="/assets/js/75.ab5a4524.js"><link rel="prefetch" href="/assets/js/76.ea1c6d79.js"><link rel="prefetch" href="/assets/js/77.711c0174.js"><link rel="prefetch" href="/assets/js/78.35dd5c6c.js"><link rel="prefetch" href="/assets/js/79.d7524830.js"><link rel="prefetch" href="/assets/js/8.badb7759.js"><link rel="prefetch" href="/assets/js/80.7e16490b.js"><link rel="prefetch" href="/assets/js/81.15f00868.js"><link rel="prefetch" href="/assets/js/82.0fe7b576.js"><link rel="prefetch" href="/assets/js/83.fc62b16f.js"><link rel="prefetch" href="/assets/js/84.2a4f555c.js"><link rel="prefetch" href="/assets/js/85.edffb2ef.js"><link rel="prefetch" href="/assets/js/86.69991118.js"><link rel="prefetch" href="/assets/js/87.621cee7a.js"><link rel="prefetch" href="/assets/js/88.5507cc10.js"><link rel="prefetch" href="/assets/js/89.5d34d988.js"><link rel="prefetch" href="/assets/js/9.d4fc76e7.js"><link rel="prefetch" href="/assets/js/90.cc841762.js"><link rel="prefetch" href="/assets/js/91.a24381d0.js"><link rel="prefetch" href="/assets/js/92.cbd5d458.js"><link rel="prefetch" href="/assets/js/93.530432c0.js"><link rel="prefetch" href="/assets/js/94.0524cfdd.js"><link rel="prefetch" href="/assets/js/95.0214ae22.js"><link rel="prefetch" href="/assets/js/96.7942792a.js"><link rel="prefetch" href="/assets/js/97.35d91de8.js"><link rel="prefetch" href="/assets/js/98.eafbdc44.js"><link rel="prefetch" href="/assets/js/99.db414aab.js">
    <link rel="stylesheet" href="/assets/css/0.styles.18a91880.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Gpingの知识库" class="logo"> <span class="site-name can-hide">Gpingの知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">🏠首页</a></div><div class="nav-item"><a href="/pages/2dbd58/" class="nav-link">📚小手册</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📖基础" class="dropdown-title"><!----> <span class="title" style="display:;">📖基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/27f9fa/" class="nav-link">Java8新特性</a></li><li class="dropdown-item"><!----> <a href="/pages/96d5aa/" class="nav-link">Java并发编程</a></li><li class="dropdown-item"><!----> <a href="/pages/00e30d/" class="nav-link">Java虚拟机</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🏷️框架" class="dropdown-title"><!----> <span class="title" style="display:;">🏷️框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/bb39d9/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/pages/24c3ee/" aria-current="page" class="nav-link router-link-exact-active router-link-active">SpringSecurity</a></li><li class="dropdown-item"><!----> <a href="/pages/1ab42b/" class="nav-link">ThingsBoard</a></li><li class="dropdown-item"><!----> <a href="/pages/fb96c3/" class="nav-link">Jpa</a></li><li class="dropdown-item"><!----> <a href="/pages/34b19f/" class="nav-link">Activiti7</a></li><li class="dropdown-item"><!----> <a href="/pages/d33c62/" class="nav-link">Quartz</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="⚔️中间件" class="dropdown-title"><!----> <span class="title" style="display:;">⚔️中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/c4d661/" class="nav-link">Rabbitmq</a></li><li class="dropdown-item"><!----> <a href="/pages/fe0a41/" class="nav-link">Kafka</a></li><li class="dropdown-item"><!----> <a href="/pages/eeddc3/" class="nav-link">Canal</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📁数据库" class="dropdown-title"><!----> <span class="title" style="display:;">📁数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/0ef684/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/a174cd/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4cfb74/" class="nav-link">InfluxDB</a></li><li class="dropdown-item"><!----> <a href="/pages/9c8057/" class="nav-link">ClickHouse</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🧰实用工具" class="dropdown-title"><!----> <span class="title" style="display:;">🧰实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/32a577/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/9864be/" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/pages/f5b30e/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/290042/" class="nav-link">Arthas</a></li><li class="dropdown-item"><!----> <a href="/pages/9eb455/" class="nav-link">Idea</a></li><li class="dropdown-item"><!----> <a href="/pages/151c97/" class="nav-link">开发工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🐞运维" class="dropdown-title"><!----> <span class="title" style="display:;">🐞运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/748b9f/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/4b6fee/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💡其他" class="dropdown-title"><!----> <span class="title" style="display:;">💡其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9cc0e1/" class="nav-link">高项</a></li><li class="dropdown-item"><!----> <a href="/pages/10e161/" class="nav-link">不一样的树形构建方式</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">🏠首页</a></div><div class="nav-item"><a href="/pages/2dbd58/" class="nav-link">📚小手册</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📖基础" class="dropdown-title"><!----> <span class="title" style="display:;">📖基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/27f9fa/" class="nav-link">Java8新特性</a></li><li class="dropdown-item"><!----> <a href="/pages/96d5aa/" class="nav-link">Java并发编程</a></li><li class="dropdown-item"><!----> <a href="/pages/00e30d/" class="nav-link">Java虚拟机</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🏷️框架" class="dropdown-title"><!----> <span class="title" style="display:;">🏷️框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/bb39d9/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/pages/24c3ee/" aria-current="page" class="nav-link router-link-exact-active router-link-active">SpringSecurity</a></li><li class="dropdown-item"><!----> <a href="/pages/1ab42b/" class="nav-link">ThingsBoard</a></li><li class="dropdown-item"><!----> <a href="/pages/fb96c3/" class="nav-link">Jpa</a></li><li class="dropdown-item"><!----> <a href="/pages/34b19f/" class="nav-link">Activiti7</a></li><li class="dropdown-item"><!----> <a href="/pages/d33c62/" class="nav-link">Quartz</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="⚔️中间件" class="dropdown-title"><!----> <span class="title" style="display:;">⚔️中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/c4d661/" class="nav-link">Rabbitmq</a></li><li class="dropdown-item"><!----> <a href="/pages/fe0a41/" class="nav-link">Kafka</a></li><li class="dropdown-item"><!----> <a href="/pages/eeddc3/" class="nav-link">Canal</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📁数据库" class="dropdown-title"><!----> <span class="title" style="display:;">📁数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/0ef684/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/a174cd/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4cfb74/" class="nav-link">InfluxDB</a></li><li class="dropdown-item"><!----> <a href="/pages/9c8057/" class="nav-link">ClickHouse</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🧰实用工具" class="dropdown-title"><!----> <span class="title" style="display:;">🧰实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/32a577/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/9864be/" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/pages/f5b30e/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/290042/" class="nav-link">Arthas</a></li><li class="dropdown-item"><!----> <a href="/pages/9eb455/" class="nav-link">Idea</a></li><li class="dropdown-item"><!----> <a href="/pages/151c97/" class="nav-link">开发工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🐞运维" class="dropdown-title"><!----> <span class="title" style="display:;">🐞运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/748b9f/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/4b6fee/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💡其他" class="dropdown-title"><!----> <span class="title" style="display:;">💡其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9cc0e1/" class="nav-link">高项</a></li><li class="dropdown-item"><!----> <a href="/pages/10e161/" class="nav-link">不一样的树形构建方式</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringSecurity</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/24c3ee/" aria-current="page" class="active sidebar-link">Spring Security</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/24c3ee/#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header level2"><a href="/pages/24c3ee/#认证与授权" class="sidebar-link">认证与授权</a></li><li class="sidebar-sub-header level2"><a href="/pages/24c3ee/#用户认证" class="sidebar-link">用户认证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/24c3ee/#表单身份验证和http基础认证" class="sidebar-link">表单身份验证和HTTP基础认证</a></li><li class="sidebar-sub-header level4"><a href="/pages/24c3ee/#基于表单的身份验证" class="sidebar-link">基于表单的身份验证</a></li><li class="sidebar-sub-header level4"><a href="/pages/24c3ee/#http-基本身份验证" class="sidebar-link">HTTP 基本身份验证</a></li><li class="sidebar-sub-header level3"><a href="/pages/24c3ee/#spring-security-中的用户对象和认证对象" class="sidebar-link">Spring Security 中的用户对象和认证对象</a></li><li class="sidebar-sub-header level4"><a href="/pages/24c3ee/#spring-security-中的用户对象" class="sidebar-link">Spring Security 中的用户对象</a></li><li class="sidebar-sub-header level4"><a href="/pages/24c3ee/#spring-security-中的认证对象" class="sidebar-link">Spring Security 中的认证对象</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/24c3ee/#访问授权" class="sidebar-link">访问授权</a></li><li class="sidebar-sub-header level2"><a href="/pages/24c3ee/#什么是oauth2-0协议" class="sidebar-link">什么是OAuth2.0协议？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/24c3ee/#简述" class="sidebar-link">简述</a></li><li class="sidebar-sub-header level3"><a href="/pages/24c3ee/#oauth2协议的角色" class="sidebar-link">OAuth2协议的角色</a></li><li class="sidebar-sub-header level3"><a href="/pages/24c3ee/#oauth2协议的令牌" class="sidebar-link">OAuth2协议的令牌</a></li><li class="sidebar-sub-header level3"><a href="/pages/24c3ee/#oauth2认证流程" class="sidebar-link">OAuth2认证流程</a></li><li class="sidebar-sub-header level3"><a href="/pages/24c3ee/#oauth2协议的四种授权模式" class="sidebar-link">OAuth2协议的四种授权模式</a></li><li class="sidebar-sub-header level4"><a href="/pages/24c3ee/#授权码模式" class="sidebar-link">授权码模式</a></li><li class="sidebar-sub-header level4"><a href="/pages/24c3ee/#简化模式" class="sidebar-link">简化模式</a></li><li class="sidebar-sub-header level4"><a href="/pages/24c3ee/#密码模式" class="sidebar-link">密码模式</a></li><li class="sidebar-sub-header level4"><a href="/pages/24c3ee/#客户端模式" class="sidebar-link">客户端模式</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/24c3ee/#搭建授权服务器" class="sidebar-link">搭建授权服务器</a></li><li class="sidebar-sub-header level2"><a href="/pages/24c3ee/#什么jwt令牌" class="sidebar-link">什么JWT令牌？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/24c3ee/#简述-2" class="sidebar-link">简述</a></li><li class="sidebar-sub-header level3"><a href="/pages/24c3ee/#跨域认证的问题" class="sidebar-link">跨域认证的问题</a></li><li class="sidebar-sub-header level3"><a href="/pages/24c3ee/#jwt的基本结构" class="sidebar-link">JWT的基本结构</a></li><li class="sidebar-sub-header level3"><a href="/pages/24c3ee/#集成oauth协议与jwt" class="sidebar-link">集成OAuth协议与JWT</a></li><li class="sidebar-sub-header level3"><a href="/pages/24c3ee/#更新令牌" class="sidebar-link">更新令牌</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/24c3ee/#什么单点登录sso" class="sidebar-link">什么单点登录SSO？</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Jpa</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Activiti</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>quartz</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>框架</span></li><li data-v-06225672><span data-v-06225672>SpringSecurity</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>gping</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-01-25</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Spring Security<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="springsecurity"><a href="#springsecurity" class="header-anchor">#</a> SpringSecurity</h1> <p><img src="https://gitee.com/studentgitee/note-picture/raw/master/image-20230210143018927.png" alt="image-20230210143018927"></p> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <blockquote><p>Spring Security 是一个基于 Spring 框架的安全框架，它提供了一系列的安全服务和安全访问控制管理功能，用于保护应用程序中的资源不被未经授权的用户访问或修改。它可以处理各种常见的安全需求，例如用户认证、授权、密码加密和会话管理等，并提供了可扩展性和自定义性，方便开发者进行二次开发和拓展。</p></blockquote> <h2 id="认证与授权"><a href="#认证与授权" class="header-anchor">#</a> 认证与授权</h2> <p>在我们的软件系统中，开发人员通常把访问的内容定义为资源，而安全性设计就是对这些资源进行保护。例如在web应用程序</p> <p>中，对外暴露的HTTP端点就可以被理解成资源。在了解这些技术体系之前，先来说明两个比较混淆的概念</p> <p>认证（ <strong>authentication</strong>）和授权（<strong>authorization</strong>）。</p> <p>所谓的<strong>认证</strong>，解决的是“你是谁“的这一个问题。关于验证你的凭据，如用户名/邮箱和密码，以验证访问者的身份。一旦明确了“你是谁“，那么下一步就是判断“你能做什么”，这个步骤就是“<strong>授权</strong>”。</p> <p><img src="https://gitee.com/studentgitee/note-picture/raw/master/image-20230312123447726.png" alt="image-20230312123447726"></p> <h2 id="用户认证"><a href="#用户认证" class="header-anchor">#</a> 用户认证</h2> <h3 id="表单身份验证和http基础认证"><a href="#表单身份验证和http基础认证" class="header-anchor">#</a> 表单身份验证和HTTP基础认证</h3> <h4 id="基于表单的身份验证"><a href="#基于表单的身份验证" class="header-anchor">#</a> 基于表单的身份验证</h4> <p>基于表单的身份验证是最常用的身份验证机制之一。在这种机制下，用户在登录页面输入用户名和密码，然后将其提交给应用程</p> <p>序进行身份验证。如果身份验证成功，用户将被授予访问受保护资源的权限。</p> <p>Spring Security 提供了内置的表单登录功能，可以快速配置和使用。在 Spring Security 的配置中，你可以通过配置 <code>formLogin()</code></p> <p>方法来启用基于表单的身份验证：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http
        <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">logoutSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login?logout&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>在上面的配置中，我们启用了基于表单的身份验证，并将登录页面设置为 <code>/login</code>。当用户访问受保护资源时，Spring Security 将</p> <p>自动跳转到登录页面，并等待用户输入用户名和密码进行身份验证。</p> <h4 id="http-基本身份验证"><a href="#http-基本身份验证" class="header-anchor">#</a> HTTP 基本身份验证</h4> <p>HTTP 基本身份验证是一种简单的身份验证机制，它需要在 HTTP 标头中包含用户名和密码，这些信息以 Base64 编码形式发送给</p> <p>服务器。虽然它比基于表单的身份验证更简单，但也存在一些限制，例如安全性较低，无法提供 CSRF 保护等。</p> <p>在 Spring Security 的配置中，你可以通过配置 <code>httpBasic()</code> 方法来启用 HTTP 基本身份验证：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http
        <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">httpBasic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在上面的配置中，我们启用了 HTTP 基本身份验证，并将其应用于所有的请求。当用户访问受保护资源时，Spring Security 将自</p> <p>动发送 HTTP 基本身份验证请求，并等待用户输入用户名和密码进行身份验证。</p> <h3 id="spring-security-中的用户对象和认证对象"><a href="#spring-security-中的用户对象和认证对象" class="header-anchor">#</a> Spring Security 中的用户对象和认证对象</h3> <h4 id="spring-security-中的用户对象"><a href="#spring-security-中的用户对象" class="header-anchor">#</a> Spring Security 中的用户对象</h4> <p>Spring Security中的用户对象用来描述用户并完成对用户信息进行管理，设计以上4个核心用户对象。</p> <ul><li>UserDetails：描述 Spring Security中的用户</li> <li>GrantedAuthority:定义用户所能执行的操作权限</li> <li>UserDetailService：定义对UserDetails的查询操作,<code>UserDetailsService</code> 的实现类将根据用户名查找用户信息，并返回一个 <code>UserDetails</code> 对象，用于后续的身份认证处理</li> <li>UserDetailManager：扩展UserDetailService，添加创建用户、修改用户密码等功能</li></ul> <p>通常Spring Security 自带的UserDetails是不能满足我们的业务需求，通常我们自定义一个UserDetails，如下</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomUserDetails</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetails</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CustomUserDetails</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities<span class="token punctuation">)</span>    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> password<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>authorities <span class="token operator">=</span> authorities<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 返回用户拥有的权限集合。</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> authorities<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 返回用户的密码</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> password<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 返回用户的用户名。</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> username<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 返回一个布尔值，表示用户的账号是否已过期。</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 返回一个布尔值，表示用户的账号是否已锁定。</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 返回一个布尔值，表示用户的凭证（如密码）是否已过期。</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 返回一个布尔值，表示用户是否可用。</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h4 id="spring-security-中的认证对象"><a href="#spring-security-中的认证对象" class="header-anchor">#</a> Spring Security 中的认证对象</h4> <h2 id="访问授权"><a href="#访问授权" class="header-anchor">#</a> 访问授权</h2> <h2 id="什么是oauth2-0协议"><a href="#什么是oauth2-0协议" class="header-anchor">#</a> 什么是OAuth2.0协议？</h2> <h3 id="简述"><a href="#简述" class="header-anchor">#</a> 简述</h3> <p>OAuth2.0（开放授权）是一个关于<strong>授权</strong>的开放的网络协议。允许用户授权第三方应用访问他们存储在另外的服务提供者上的资源</p> <p>（如：照片，视频，联系人列表），而无需将用户名和密码提供给第三方应用。</p> <p>比如使用登录百度（第三方应用）的时候，使用QQ（服务提供者）来登录，百度对于QQ方来说属于第三方应用。</p> <h3 id="oauth2协议的角色"><a href="#oauth2协议的角色" class="header-anchor">#</a> OAuth2协议的角色</h3> <p>Oauth2协议中定义了4种角色，分别为资源拥有者（Resouece Owner）、客户端（client）、资源服务器（Resource Server）、授权服务器（Authorization Server）。</p> <p><img src="https://gitee.com/studentgitee/note-picture/raw/master/image-20230311195131585.png" alt="image-20230311195131585"></p> <p>1、资源拥有者</p> <p>能够授予对受保护资源的访问权限的实体，如果资源的所有者为个人，也被成为最终用户（比如拥有QQ的账号密码）。</p> <p>2、客户端</p> <p>案例中的百度代表的是第三方应用程序，通常被称为客户端。</p> <p>3、与客户端相对应的是，OAuth2协议中还存在一个服务提供商，案例中的QQ扮演了该角色。服务提供商拥有一个资源服务器和授权服务器。其中</p> <ul><li>资源服务器：存在用户资源，比如QQ中的头像图片、昵称、id等。、</li> <li>授权服务器：完成这对用户的授权流程，验证资源拥有者并获取授权成功后，向客户颁发访问令牌</li></ul> <h3 id="oauth2协议的令牌"><a href="#oauth2协议的令牌" class="header-anchor">#</a> OAuth2协议的令牌</h3> <p>令牌是OAuth中的核心组件，它代表了一次授权的结果，包含了资源拥有者、授权服务器、客户端、受保护资源、权限范围等信息。</p> <p>如下所示的就是一种常见的令牌信息</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;access_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;U6mWxkh6BLodmRvgMKOWn9mZaOo&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;token_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bearer&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;refresh_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6xKVnEK3I9vQ1g0gjoVXI27fKj4&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;expires_in&quot;</span><span class="token operator">:</span> <span class="token number">43199</span><span class="token punctuation">,</span>
    <span class="token string">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>access_token：代表的是OAuth2的令牌，当访问每个受保护的资源时，用户都需要携带该令牌进行验证。</li> <li>token_teyp：代表令牌类型，OAuth2协议中有许多可选的令牌类型，包括bearer类型、mac类型等。</li> <li>expires_in：拥有指定access_token的过期时间，一旦查过该有效时间，access_token将会自动失效。</li> <li>refresh_token：用于当access_token过期之后重新颁发下一个新的access_token。</li> <li>scope：指定可访问的权限范围。</li></ul> <h3 id="oauth2认证流程"><a href="#oauth2认证流程" class="header-anchor">#</a> OAuth2认证流程</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>     <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>                               <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
     <span class="token operator">|</span>        <span class="token operator">|</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">)</span><span class="token operator">-</span> <span class="token class-name">Authorization</span> <span class="token class-name">Request</span> <span class="token operator">-&gt;</span><span class="token operator">|</span>   <span class="token class-name">Resource</span>    <span class="token operator">|</span>
     <span class="token operator">|</span>        <span class="token operator">|</span>                               <span class="token operator">|</span>     <span class="token class-name">Owner</span>     <span class="token operator">|</span>
     <span class="token operator">|</span>        <span class="token operator">|</span><span class="token operator">&lt;</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">)</span><span class="token operator">--</span> <span class="token class-name">Authorization</span> <span class="token class-name">Grant</span> <span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span>               <span class="token operator">|</span>
     <span class="token operator">|</span>        <span class="token operator">|</span>                               <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
     <span class="token operator">|</span>        <span class="token operator">|</span>
     <span class="token operator">|</span>        <span class="token operator">|</span>                               <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
     <span class="token operator">|</span>        <span class="token operator">|</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token class-name">C</span><span class="token punctuation">)</span><span class="token operator">--</span> <span class="token class-name">Authorization</span> <span class="token class-name">Grant</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">|</span> <span class="token class-name">Authorization</span> <span class="token operator">|</span>
     <span class="token operator">|</span> <span class="token class-name">Client</span> <span class="token operator">|</span>                               <span class="token operator">|</span>     <span class="token class-name">Server</span>    <span class="token operator">|</span>
     <span class="token operator">|</span>        <span class="token operator">|</span><span class="token operator">&lt;</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token class-name">D</span><span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token class-name">Access</span> <span class="token class-name">Token</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span>               <span class="token operator">|</span>
     <span class="token operator">|</span>        <span class="token operator">|</span>                               <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
     <span class="token operator">|</span>        <span class="token operator">|</span>
     <span class="token operator">|</span>        <span class="token operator">|</span>                               <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
     <span class="token operator">|</span>        <span class="token operator">|</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token class-name">Access</span> <span class="token class-name">Token</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">|</span>    <span class="token class-name">Resource</span>   <span class="token operator">|</span>
     <span class="token operator">|</span>        <span class="token operator">|</span>                               <span class="token operator">|</span>     <span class="token class-name">Server</span>    <span class="token operator">|</span>
     <span class="token operator">|</span>        <span class="token operator">|</span><span class="token operator">&lt;</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token class-name">F</span><span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token class-name">Protected</span> <span class="token class-name">Resource</span> <span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span>               <span class="token operator">|</span>
     <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>                               <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>(A)  用户打开客户端以后，客户端要求用户给予授权。
（B）用户同意给予客户端授权。
（C）客户端使用上一步获得的授权，向认证服务器申请令牌。
（D）认证服务器对客户端进行认证以后，确认无误，同意发放令牌。
（E）客户端使用令牌，向资源服务器申请获取资源。
（F）资源服务器确认令牌无误，同意向客户端开放资源。</p> <p>上面可以看出（B）步骤是最重要的，即用户怎样才能给于客户端授权。有了这个授权以后，客户端就可以获取令牌，进而凭令牌获取资源。</p> <h3 id="oauth2协议的四种授权模式"><a href="#oauth2协议的四种授权模式" class="header-anchor">#</a> OAuth2协议的四种授权模式</h3> <h4 id="授权码模式"><a href="#授权码模式" class="header-anchor">#</a> 授权码模式</h4> <blockquote><p>功能最完整、流程最严密的授权模式。它的特点就是通过客户端的后台服务器，与&quot;服务提供商&quot;的认证服务器进行互动。</p></blockquote> <table><thead><tr><th style="text-align:center;">参数</th> <th style="text-align:center;">解释</th></tr></thead> <tbody><tr><td style="text-align:center;">response_type</td> <td style="text-align:center;">必须，固定为code，表示要求返回授权码</td></tr> <tr><td style="text-align:center;">client_id</td> <td style="text-align:center;">必须，在QQ授权服务器注册后得到的客户端标识，让 QQ授权服务器知道是谁在请求</td></tr> <tr><td style="text-align:center;">client_secret</td> <td style="text-align:center;">客户端密钥</td></tr> <tr><td style="text-align:center;">redirect_uri</td> <td style="text-align:center;">可选， 接受或拒绝请求后的跳转网址</td></tr> <tr><td style="text-align:center;">scope</td> <td style="text-align:center;">可选，表示请求资源的范围</td></tr></tbody></table> <p><img src="https://gitee.com/studentgitee/note-picture/raw/master/image-20230311204219915.png" alt="image-20230311204219915"></p> <p>首先，用户在访问客户端的时候会被导向授权服务器，这时候，用户可以选择是否向客户端授权。</p> <p>其次，一旦用户同意授权，授权服务器会调用客户端注册时所提供的回调地址，并在调用的程中将授权码直接返回给到客户端。</p> <p>再次，客户端收到授权码后，会携带授权码和客户端密钥再一次向授权服务器请求访问令牌。</p> <p>最后，授权服务器核对授权码以及客户端密钥，并向客户端发送访问令牌。</p> <h4 id="简化模式"><a href="#简化模式" class="header-anchor">#</a> 简化模式</h4> <blockquote><p>不通过第三方应用程序的服务器，直接在浏览器中向认证服务器申请令牌，跳过了&quot;授权码&quot;这个步骤，因此得名。所有步骤在浏览器中完成，令牌对访问者是可见的，且客户端不需要认证。</p></blockquote> <p><img src="https://gitee.com/studentgitee/note-picture/raw/master/image-20230312121955424.png" alt="image-20230312121955424"></p> <h4 id="密码模式"><a href="#密码模式" class="header-anchor">#</a> 密码模式</h4> <blockquote><p>如果你高度信任某个应用，RFC 6749 也允许用户把用户名和密码，直接告诉该应用。该应用就使用你的密码，申请令牌，这种方式称为&quot;密码式&quot;（password）。</p></blockquote> <p><img src="https://gitee.com/studentgitee/note-picture/raw/master/image-20230311204857580.png" alt="image-20230311204857580"></p> <p>可以看到，密码模式比较简单，更加的容易理解。用户要 做的事情就是向客户端提供用户名和密码，然后客户端基于这些用户信息向授权服务器请求访问令牌。授权服务器成功的认证用户的信息后将会颁发令牌。</p> <h4 id="客户端模式"><a href="#客户端模式" class="header-anchor">#</a> 客户端模式</h4> <p><img src="https://gitee.com/studentgitee/note-picture/raw/master/image-20230312122126641.png" alt="image-20230312122126641"></p> <h2 id="搭建授权服务器"><a href="#搭建授权服务器" class="header-anchor">#</a> 搭建授权服务器</h2> <h2 id="什么jwt令牌"><a href="#什么jwt令牌" class="header-anchor">#</a> 什么JWT令牌？</h2> <h3 id="简述-2"><a href="#简述-2" class="header-anchor">#</a> 简述</h3> <blockquote><p>JWT全称为JSON Web Token，它本质上是一种基于JSON格式表示的令牌。是目前最流行的跨域认证解决方案。</p></blockquote> <h3 id="跨域认证的问题"><a href="#跨域认证的问题" class="header-anchor">#</a> 跨域认证的问题</h3> <p>互联网服务离不开用户认证。一般流程是下面这样。</p> <blockquote><p>1、用户向服务器发送用户名和密码。</p> <p>2、服务器验证通过后，在当前对话（session）里面保存相关数据，比如用户角色、登录时间等等。</p> <p>3、服务器向用户返回一个 session_id，写入用户的 Cookie。</p> <p>4、用户随后的每一次请求，都会通过 Cookie，将 session_id 传回服务器。</p> <p>5、服务器收到 session_id，找到前期保存的数据，由此得知用户的身份。</p></blockquote> <blockquote><p>1、这种模式的问题在于，扩展性差。单机当然没有问题，如果是服务器集群，或者是跨域的服务导向架构，就要求 **session **</p> <p><strong>数据共享</strong>，每台服务器都能够读取 session。</p> <p>2、举例来说，A 网站和 B 网站是同一家公司的关联服务。现在要求，用户只要在其中一个网站登录，再访问另一个网站就会</p> <p>自动登录，请问怎么实现？</p> <p>3、一种解决方案是 session 数据持久化，写入数据库或别的持久层。各种服务收到请求后，都向持久层请求数据。这种方案</p> <p>的优点是架构清晰，缺点是工程量比较大。另外，持久层万一挂了，就会单点失败。另一种方案是服务器索性不保存</p> <p>session 数据了，所有数据都保存在客户端，每次请求都发回服务器。JWT 就是这种方案的一个代表。</p></blockquote> <h3 id="jwt的基本结构"><a href="#jwt的基本结构" class="header-anchor">#</a> JWT的基本结构</h3> <blockquote><p>从结构上来说，JWT本身有三段信息构成。</p> <p>第一段位头部（Header）、第二段为有效负载（Payload）、第三段为签名（Signature）。</p></blockquote> <p>写成一行，就是下面的样子</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Header<span class="token punctuation">.</span>Payload<span class="token punctuation">.</span>Signature</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9<span class="token punctuation">.</span>
eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ1c2VyIiwic2NvcGUiOlsiYWxsIl0sImV4cCI6MTYzODYwNTcxOCwiYXV0aG9yaXRpZXMiOlsiUk9MRV91c2VyIl0sImp0aSI6ImRkNTVkMjEzLThkMDYtNGY4MC1iMGRmLTdkN2E0YWE2MmZlOSIsImNsaWVudF9pZCI6Im15anN6bCJ9<span class="token punctuation">.</span>
koup5<span class="token operator">-</span>wzGfcSVnaaNfILwAgw2VaTLvRgq2JVnIHYe_Q
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;access_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2Nzg2MzU0NDEsInVzZXJfbmFtZSI6ImFkbWluIiwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiJlSmpHcWlZb1gybWRwSEdrUXdPQjM5MHhJeWsiLCJjbGllbnRfaWQiOiJtZXNzYWdpbmctY2xpZW50Iiwic2NvcGUiOlsiYWxsIl19.rlJNRneuJGaP9PaF47jGwyiHsiw4USwNPXPADZ7kYe8&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;token_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bearer&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;refresh_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX25hbWUiOiJhZG1pbiIsInNjb3BlIjpbImFsbCJdLCJhdGkiOiJlSmpHcWlZb1gybWRwSEdrUXdPQjM5MHhJeWsiLCJleHAiOjE2ODExODQyNDEsImF1dGhvcml0aWVzIjpbIlJPTEVfQURNSU4iLCJST0xFX1VTRVIiXSwianRpIjoiVXhNbDlNQ0wybUdjWGdUakE0b2VNZHN1cmFBIiwiY2xpZW50X2lkIjoibWVzc2FnaW5nLWNsaWVudCJ9.Q91AFIbOqH-Smp8heqYmz02nCjFPYnHpdHAo4-TqhCI&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;expires_in&quot;</span><span class="token operator">:</span> <span class="token number">43199</span><span class="token punctuation">,</span>
    <span class="token string">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;jti&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eJjGqiYoX2mdpHGkQwOB390xIyk&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>access_token和refresh_token都是经过Base64URL进行了加密。需要使用在线解析工具https://tooltt.com/jwt-decode/解析后得到如下结果：</p> <div class="language-jwt line-numbers-mode"><pre class="language-text"><code>{
  &quot;alg&quot;: &quot;HS256&quot;,
  &quot;typ&quot;: &quot;JWT&quot;
}.
{
  &quot;exp&quot;: 1678635441,
  &quot;user_name&quot;: &quot;admin&quot;,
  &quot;authorities&quot;: [
    &quot;ROLE_ADMIN&quot;,
    &quot;ROLE_USER&quot;
  ],
  &quot;jti&quot;: &quot;eJjGqiYoX2mdpHGkQwOB390xIyk&quot;,
  &quot;client_id&quot;: &quot;messaging-client&quot;,
  &quot;scope&quot;: [
    &quot;all&quot;
  ]
}.
[signature]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>头部(Header)</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;alg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HS256&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;typ&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JWT&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上面代码中，<code>alg</code>属性表示签名的算法（algorithm），默认是 HMAC SHA256（写成 HS256）；<code>typ</code>属性表示这个令牌（token）的类型（type），JWT 令牌统一写为<code>JWT</code>。</p> <p><strong>有效负载(Payload)</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;exp&quot;</span><span class="token operator">:</span> <span class="token number">1678635441</span><span class="token punctuation">,</span>
  <span class="token string">&quot;user_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;authorities&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;ROLE_ADMIN&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;ROLE_USER&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;jti&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eJjGqiYoX2mdpHGkQwOB390xIyk&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;client_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;messaging-client&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;all&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Payload 部分也是一个 JSON 对象，用来存放实际需要传递的数据。JWT 规定了7个官方字段，供选用。</p> <blockquote><ul><li>iss (issuer)：签发人</li> <li>exp (expiration time)：过期时间</li> <li>sub (subject)：主题</li> <li>aud (audience)：受众</li> <li>nbf (Not Before)：生效时间</li> <li>iat (Issued At)：签发时间</li> <li>jti (JWT ID)：编号</li></ul></blockquote> <p>除了官方字段，你还可以在这个部分定义私有字段，下面就是一个例子。</p> <div class="language-jwt line-numbers-mode"><pre class="language-text"><code>{
  &quot;sub&quot;: &quot;1234567890&quot;,
  &quot;name&quot;: &quot;John Doe&quot;,
  &quot;admin&quot;: true
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>签名（Signature）</strong></p> <p>Signature 部分是对前两部分的签名，防止数据篡改。</p> <p>首先，需要指定一个密钥（secret）。这个密钥只有服务器才知道，不能泄露给用户。然后，使用 Header 里面指定的签名算法（默认是 HMAC SHA256），按照下面的公式产生签名。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">HMACSHA256</span><span class="token punctuation">(</span>
  <span class="token function">base64UrlEncode</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span>
  <span class="token function">base64UrlEncode</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span>
  secret<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>算出签名以后，把 Header、Payload、Signature 三个部分拼成一个字符串，每个部分之间用&quot;点&quot;（<code>.</code>）分隔，就可以返回给用户。</p> <h3 id="集成oauth协议与jwt"><a href="#集成oauth协议与jwt" class="header-anchor">#</a> 集成OAuth协议与JWT</h3> <p>首先在Maven的pom文件中引入对应的依赖包，该maven包含了jwt的依赖</p> <div class="language-maven line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security.oauth&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-oauth2&lt;/artifactId&gt;
            &lt;version&gt;2.5.2.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>通过一个配置类来完成JWT的生成和转换。OAuth2协议专门提供了一个接口用于管理令牌的存储，即TokenStore。我们创建一个用于配置JwtTokenStore的配置类<strong>JwtTokenStoreConfig</strong>，如下所示。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @Description 管理jwt令牌存储
 * @Author MrWei
 * @Date 2023/3/12 11:17
 **/</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtTokenStoreConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * JWT密钥
     * 实际项目中是放到配置文件里面，资源服务也需要用到
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">SIGN_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 令牌的存储策略：使用jwt令牌
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TokenStore</span> <span class="token function">tokenStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JwtTokenStore</span><span class="token punctuation">(</span><span class="token function">jwtAccessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">JwtAccessTokenConverter</span> <span class="token function">jwtAccessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JwtAccessTokenConverter</span> jwtAccessTokenConverter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JwtAccessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 对称秘钥，资源服务器使用该秘钥来验证</span>
        jwtAccessTokenConverter<span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span><span class="token constant">SIGN_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> jwtAccessTokenConverter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 令牌管理服务
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DefaultTokenServices</span> <span class="token function">tokenService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultTokenServices</span> service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultTokenServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 是否产生支持刷新令牌</span>
        service<span class="token punctuation">.</span><span class="token function">setSupportRefreshToken</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 令牌存储策略</span>
        service<span class="token punctuation">.</span><span class="token function">setTokenStore</span><span class="token punctuation">(</span><span class="token function">tokenStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// access_token令牌桶默认有效期2小时</span>
        service<span class="token punctuation">.</span><span class="token function">setAccessTokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 刷新令牌默认有效期3天</span>
        service<span class="token punctuation">.</span><span class="token function">setRefreshTokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> service<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>上述<strong>JwtTokenStoreConfig</strong>的作用是创建一系列对象供Spirng容器使用，那么在什么时候会用到这些对象呢？答案是在将JWT集成到OAuth2授权服务的过程中。</p> <p>通过构建一个配置类来覆写<strong>AuthorizationServerConfigurerAdapter</strong>中的**configure()**方法。在集成JWT之后，该方法的实现需要调整为一下形势。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">/**
     * 配置端点行为
     * @param endpoints
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationServerEndpointsConfigurer</span> endpoints<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 设置令牌增强链</span>
        <span class="token class-name">TokenEnhancerChain</span> tokenEnhancerChain <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenEnhancerChain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokenEnhancerChain<span class="token punctuation">.</span><span class="token function">setTokenEnhancers</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>jwtAccessTokenConverter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/**
         * tokenStore:设置 AccessToken的存储介质tokenStore， 默认使用内存当做存储介质。
         * accessTokenConverter:设置jwt对象
         * authenticationManager:在授权模式为密码模式时，需要一个认证管理器，用于对用户名和密码进行认证。
         * userDetailsService：基于密码的授权模式，所以需要指定一个自定义的userDetailsService替换全局的实现。
         */</span>
        endpoints
                <span class="token punctuation">.</span><span class="token function">tokenStore</span><span class="token punctuation">(</span>tokenStore<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">accessTokenConverter</span><span class="token punctuation">(</span>jwtAccessTokenConverter<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authenticationManager</span><span class="token punctuation">(</span>authenticationManager<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">userDetailsService</span><span class="token punctuation">(</span>userDetailsService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>至此，我们在OAuth2协议中集成JWT。</p> <h3 id="更新令牌"><a href="#更新令牌" class="header-anchor">#</a> 更新令牌</h3> <h2 id="什么单点登录sso"><a href="#什么单点登录sso" class="header-anchor">#</a> 什么单点登录SSO？</h2> <p>待更新.......................</p></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/05/10, 22:49:09</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/56baf9/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Spring应用上下文生命周期（Container Lifecycle）</div></a> <a href="/pages/fb96c3/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">JPA 简介</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/56baf9/" class="prev">Spring应用上下文生命周期（Container Lifecycle）</a></span> <span class="next"><a href="/pages/fb96c3/">JPA 简介</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2024
    <span>Gping | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.57e44612.js" defer></script><script src="/assets/js/2.ea24d1ee.js" defer></script><script src="/assets/js/60.5946ddf4.js" defer></script>
  </body>
</html>
