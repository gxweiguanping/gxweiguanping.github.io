<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>kafka命令行工具 | Gpingの知识库</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="记录学习路上的点点滴滴">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer">
    
    <link rel="preload" href="/assets/css/0.styles.18a91880.css" as="style"><link rel="preload" href="/assets/js/app.57e44612.js" as="script"><link rel="preload" href="/assets/js/2.ea24d1ee.js" as="script"><link rel="preload" href="/assets/js/174.1cacb422.js" as="script"><link rel="prefetch" href="/assets/js/10.87a7fc9a.js"><link rel="prefetch" href="/assets/js/100.1dde94ac.js"><link rel="prefetch" href="/assets/js/101.a9e60cd0.js"><link rel="prefetch" href="/assets/js/102.41fc30c1.js"><link rel="prefetch" href="/assets/js/103.d66d2d71.js"><link rel="prefetch" href="/assets/js/104.22cb586e.js"><link rel="prefetch" href="/assets/js/105.2e7087a4.js"><link rel="prefetch" href="/assets/js/106.f3ea04f4.js"><link rel="prefetch" href="/assets/js/107.1fe76475.js"><link rel="prefetch" href="/assets/js/108.5419a3bf.js"><link rel="prefetch" href="/assets/js/109.25f5a5d7.js"><link rel="prefetch" href="/assets/js/11.04f09971.js"><link rel="prefetch" href="/assets/js/110.859d6308.js"><link rel="prefetch" href="/assets/js/111.1007812c.js"><link rel="prefetch" href="/assets/js/112.1e3ac86b.js"><link rel="prefetch" href="/assets/js/113.39632362.js"><link rel="prefetch" href="/assets/js/114.cd109b57.js"><link rel="prefetch" href="/assets/js/115.738c1531.js"><link rel="prefetch" href="/assets/js/116.8afaf129.js"><link rel="prefetch" href="/assets/js/117.fc53579f.js"><link rel="prefetch" href="/assets/js/118.21a1f8c4.js"><link rel="prefetch" href="/assets/js/119.0a6295f3.js"><link rel="prefetch" href="/assets/js/12.39c155f1.js"><link rel="prefetch" href="/assets/js/120.b52ae2c0.js"><link rel="prefetch" href="/assets/js/121.a7d78631.js"><link rel="prefetch" href="/assets/js/122.a28e6a23.js"><link rel="prefetch" href="/assets/js/123.c426392a.js"><link rel="prefetch" href="/assets/js/124.c522482b.js"><link rel="prefetch" href="/assets/js/125.92a0ca2c.js"><link rel="prefetch" href="/assets/js/126.c7e332fc.js"><link rel="prefetch" href="/assets/js/127.09fed274.js"><link rel="prefetch" href="/assets/js/128.5b2b776f.js"><link rel="prefetch" href="/assets/js/129.78e15024.js"><link rel="prefetch" href="/assets/js/13.2b02d3de.js"><link rel="prefetch" href="/assets/js/130.97b2a44d.js"><link rel="prefetch" href="/assets/js/131.0453b852.js"><link rel="prefetch" href="/assets/js/132.1d3bd373.js"><link rel="prefetch" href="/assets/js/133.445fa178.js"><link rel="prefetch" href="/assets/js/134.10a04df0.js"><link rel="prefetch" href="/assets/js/135.7966ce33.js"><link rel="prefetch" href="/assets/js/136.03b5e675.js"><link rel="prefetch" href="/assets/js/137.5eed4831.js"><link rel="prefetch" href="/assets/js/138.ed4fba77.js"><link rel="prefetch" href="/assets/js/139.8eb46152.js"><link rel="prefetch" href="/assets/js/14.8881736c.js"><link rel="prefetch" href="/assets/js/140.08e196c0.js"><link rel="prefetch" href="/assets/js/141.b18b66b6.js"><link rel="prefetch" href="/assets/js/142.03a0879c.js"><link rel="prefetch" href="/assets/js/143.22fdbb7b.js"><link rel="prefetch" href="/assets/js/144.31189f97.js"><link rel="prefetch" href="/assets/js/145.75b2fd40.js"><link rel="prefetch" href="/assets/js/146.dbb475d1.js"><link rel="prefetch" href="/assets/js/147.cf107953.js"><link rel="prefetch" href="/assets/js/148.f9449ca9.js"><link rel="prefetch" href="/assets/js/149.6960a659.js"><link rel="prefetch" href="/assets/js/15.b4b6d9e8.js"><link rel="prefetch" href="/assets/js/150.f4a4a9e2.js"><link rel="prefetch" href="/assets/js/151.df5e1fda.js"><link rel="prefetch" href="/assets/js/152.b3ebe11a.js"><link rel="prefetch" href="/assets/js/153.fe7d6b3f.js"><link rel="prefetch" href="/assets/js/154.aeb16b2b.js"><link rel="prefetch" href="/assets/js/155.649eeac2.js"><link rel="prefetch" href="/assets/js/156.72888c77.js"><link rel="prefetch" href="/assets/js/157.dc67f246.js"><link rel="prefetch" href="/assets/js/158.467b9e3c.js"><link rel="prefetch" href="/assets/js/159.384e3132.js"><link rel="prefetch" href="/assets/js/16.e6a03cb0.js"><link rel="prefetch" href="/assets/js/160.75f72beb.js"><link rel="prefetch" href="/assets/js/161.c4bf3ed6.js"><link rel="prefetch" href="/assets/js/162.4e905989.js"><link rel="prefetch" href="/assets/js/163.e10e10ec.js"><link rel="prefetch" href="/assets/js/164.8c3e42dc.js"><link rel="prefetch" href="/assets/js/165.c9509c25.js"><link rel="prefetch" href="/assets/js/166.875c96b9.js"><link rel="prefetch" href="/assets/js/167.ac323741.js"><link rel="prefetch" href="/assets/js/168.6cff22a8.js"><link rel="prefetch" href="/assets/js/169.9a12d5c9.js"><link rel="prefetch" href="/assets/js/17.430c4645.js"><link rel="prefetch" href="/assets/js/170.bb307927.js"><link rel="prefetch" href="/assets/js/171.40dbf2b6.js"><link rel="prefetch" href="/assets/js/172.a11d0b5a.js"><link rel="prefetch" href="/assets/js/173.86064fd6.js"><link rel="prefetch" href="/assets/js/175.622de80a.js"><link rel="prefetch" href="/assets/js/176.de8449aa.js"><link rel="prefetch" href="/assets/js/177.cb9b484d.js"><link rel="prefetch" href="/assets/js/178.9f5c2068.js"><link rel="prefetch" href="/assets/js/179.ffff651e.js"><link rel="prefetch" href="/assets/js/18.3bb48241.js"><link rel="prefetch" href="/assets/js/180.09a9c21e.js"><link rel="prefetch" href="/assets/js/181.26ed76ed.js"><link rel="prefetch" href="/assets/js/182.17a77c05.js"><link rel="prefetch" href="/assets/js/183.53fafefd.js"><link rel="prefetch" href="/assets/js/184.a67c9279.js"><link rel="prefetch" href="/assets/js/185.5ef13915.js"><link rel="prefetch" href="/assets/js/186.80f2394f.js"><link rel="prefetch" href="/assets/js/187.9966ad44.js"><link rel="prefetch" href="/assets/js/188.03ff6401.js"><link rel="prefetch" href="/assets/js/189.0673741c.js"><link rel="prefetch" href="/assets/js/19.1a1d4b97.js"><link rel="prefetch" href="/assets/js/190.b00a4558.js"><link rel="prefetch" href="/assets/js/191.ffb3dc84.js"><link rel="prefetch" href="/assets/js/192.a1c08248.js"><link rel="prefetch" href="/assets/js/193.12c63e53.js"><link rel="prefetch" href="/assets/js/194.f33b52de.js"><link rel="prefetch" href="/assets/js/195.33c636d4.js"><link rel="prefetch" href="/assets/js/196.6c3d5dd1.js"><link rel="prefetch" href="/assets/js/197.30d1c025.js"><link rel="prefetch" href="/assets/js/198.452ad7b8.js"><link rel="prefetch" href="/assets/js/199.e5ef0a61.js"><link rel="prefetch" href="/assets/js/20.a60725d3.js"><link rel="prefetch" href="/assets/js/200.686c1f4c.js"><link rel="prefetch" href="/assets/js/201.bc89ccf8.js"><link rel="prefetch" href="/assets/js/202.59ba3183.js"><link rel="prefetch" href="/assets/js/203.bcd865f8.js"><link rel="prefetch" href="/assets/js/204.8d50c324.js"><link rel="prefetch" href="/assets/js/205.742dccae.js"><link rel="prefetch" href="/assets/js/206.88d6037a.js"><link rel="prefetch" href="/assets/js/207.190776c5.js"><link rel="prefetch" href="/assets/js/208.fa870ec7.js"><link rel="prefetch" href="/assets/js/209.0ead087a.js"><link rel="prefetch" href="/assets/js/21.6c56b6f5.js"><link rel="prefetch" href="/assets/js/210.4793eafd.js"><link rel="prefetch" href="/assets/js/211.d4701451.js"><link rel="prefetch" href="/assets/js/212.960f82e6.js"><link rel="prefetch" href="/assets/js/213.06afd767.js"><link rel="prefetch" href="/assets/js/214.7b98451d.js"><link rel="prefetch" href="/assets/js/215.78151312.js"><link rel="prefetch" href="/assets/js/216.d2f394e3.js"><link rel="prefetch" href="/assets/js/217.d6868358.js"><link rel="prefetch" href="/assets/js/218.74bb756c.js"><link rel="prefetch" href="/assets/js/219.6239b512.js"><link rel="prefetch" href="/assets/js/22.f0aec2af.js"><link rel="prefetch" href="/assets/js/220.18943948.js"><link rel="prefetch" href="/assets/js/221.952b0093.js"><link rel="prefetch" href="/assets/js/222.908dcde3.js"><link rel="prefetch" href="/assets/js/223.ccc9ca97.js"><link rel="prefetch" href="/assets/js/224.97bb1b38.js"><link rel="prefetch" href="/assets/js/225.f44d9991.js"><link rel="prefetch" href="/assets/js/226.0cbe1043.js"><link rel="prefetch" href="/assets/js/227.0ef2d9fa.js"><link rel="prefetch" href="/assets/js/228.08e2a12e.js"><link rel="prefetch" href="/assets/js/229.9d76c3da.js"><link rel="prefetch" href="/assets/js/23.b75f4ad8.js"><link rel="prefetch" href="/assets/js/230.0130ed60.js"><link rel="prefetch" href="/assets/js/231.cc7bfe6a.js"><link rel="prefetch" href="/assets/js/232.945b8961.js"><link rel="prefetch" href="/assets/js/233.b92a416e.js"><link rel="prefetch" href="/assets/js/234.1e603d6c.js"><link rel="prefetch" href="/assets/js/235.2cbbf26a.js"><link rel="prefetch" href="/assets/js/236.8c2d0914.js"><link rel="prefetch" href="/assets/js/237.6d37c843.js"><link rel="prefetch" href="/assets/js/238.328bfb17.js"><link rel="prefetch" href="/assets/js/239.3cfc2492.js"><link rel="prefetch" href="/assets/js/24.2f8e45fa.js"><link rel="prefetch" href="/assets/js/240.49c464d7.js"><link rel="prefetch" href="/assets/js/241.a117b6ed.js"><link rel="prefetch" href="/assets/js/242.f755edbf.js"><link rel="prefetch" href="/assets/js/243.d465b990.js"><link rel="prefetch" href="/assets/js/244.437ddc10.js"><link rel="prefetch" href="/assets/js/245.2e779b62.js"><link rel="prefetch" href="/assets/js/246.833a9e59.js"><link rel="prefetch" href="/assets/js/247.3642921c.js"><link rel="prefetch" href="/assets/js/248.6fe5d428.js"><link rel="prefetch" href="/assets/js/249.11831ea9.js"><link rel="prefetch" href="/assets/js/25.b05b892c.js"><link rel="prefetch" href="/assets/js/250.8c3ef99e.js"><link rel="prefetch" href="/assets/js/251.520e04bc.js"><link rel="prefetch" href="/assets/js/252.b091ccdc.js"><link rel="prefetch" href="/assets/js/253.b763e62c.js"><link rel="prefetch" href="/assets/js/254.4d336e26.js"><link rel="prefetch" href="/assets/js/255.5d47d641.js"><link rel="prefetch" href="/assets/js/256.baa3ebe3.js"><link rel="prefetch" href="/assets/js/257.2ffae9af.js"><link rel="prefetch" href="/assets/js/258.c604142e.js"><link rel="prefetch" href="/assets/js/259.e74e6cd6.js"><link rel="prefetch" href="/assets/js/26.8ba653c3.js"><link rel="prefetch" href="/assets/js/260.7b310562.js"><link rel="prefetch" href="/assets/js/261.e3b096df.js"><link rel="prefetch" href="/assets/js/262.808f799f.js"><link rel="prefetch" href="/assets/js/263.c560074f.js"><link rel="prefetch" href="/assets/js/264.a46a2877.js"><link rel="prefetch" href="/assets/js/265.d15875dc.js"><link rel="prefetch" href="/assets/js/266.44ad46e6.js"><link rel="prefetch" href="/assets/js/267.744591cc.js"><link rel="prefetch" href="/assets/js/268.b63a806f.js"><link rel="prefetch" href="/assets/js/269.2df63b7b.js"><link rel="prefetch" href="/assets/js/27.2649684b.js"><link rel="prefetch" href="/assets/js/270.96a1e8da.js"><link rel="prefetch" href="/assets/js/271.f7f48faf.js"><link rel="prefetch" href="/assets/js/272.89f1f9b3.js"><link rel="prefetch" href="/assets/js/273.9db895c8.js"><link rel="prefetch" href="/assets/js/28.04ba17fc.js"><link rel="prefetch" href="/assets/js/29.fc9bec6b.js"><link rel="prefetch" href="/assets/js/3.ebf0a2ca.js"><link rel="prefetch" href="/assets/js/30.8f6c8682.js"><link rel="prefetch" href="/assets/js/31.044a932c.js"><link rel="prefetch" href="/assets/js/32.f86a299c.js"><link rel="prefetch" href="/assets/js/33.69f05cd0.js"><link rel="prefetch" href="/assets/js/34.0fcfdfd2.js"><link rel="prefetch" href="/assets/js/35.fbba2378.js"><link rel="prefetch" href="/assets/js/36.b8c83634.js"><link rel="prefetch" href="/assets/js/37.af10d35c.js"><link rel="prefetch" href="/assets/js/38.40c50958.js"><link rel="prefetch" href="/assets/js/39.048effca.js"><link rel="prefetch" href="/assets/js/4.910990f1.js"><link rel="prefetch" href="/assets/js/40.34df2e9c.js"><link rel="prefetch" href="/assets/js/41.0d92c05d.js"><link rel="prefetch" href="/assets/js/42.7d55e3eb.js"><link rel="prefetch" href="/assets/js/43.784d6526.js"><link rel="prefetch" href="/assets/js/44.ab75d220.js"><link rel="prefetch" href="/assets/js/45.1da53631.js"><link rel="prefetch" href="/assets/js/46.2bc19c98.js"><link rel="prefetch" href="/assets/js/47.ebb349e1.js"><link rel="prefetch" href="/assets/js/48.4c790e5f.js"><link rel="prefetch" href="/assets/js/49.a08ffcbf.js"><link rel="prefetch" href="/assets/js/5.1a4306f1.js"><link rel="prefetch" href="/assets/js/50.2a986267.js"><link rel="prefetch" href="/assets/js/51.b6e6ae81.js"><link rel="prefetch" href="/assets/js/52.884f6499.js"><link rel="prefetch" href="/assets/js/53.21026904.js"><link rel="prefetch" href="/assets/js/54.da32fcd7.js"><link rel="prefetch" href="/assets/js/55.8b53dfa1.js"><link rel="prefetch" href="/assets/js/56.f61d102d.js"><link rel="prefetch" href="/assets/js/57.f4da3322.js"><link rel="prefetch" href="/assets/js/58.5e3282e7.js"><link rel="prefetch" href="/assets/js/59.a84fd4f0.js"><link rel="prefetch" href="/assets/js/6.051801a8.js"><link rel="prefetch" href="/assets/js/60.5946ddf4.js"><link rel="prefetch" href="/assets/js/61.18c749ab.js"><link rel="prefetch" href="/assets/js/62.da684abf.js"><link rel="prefetch" href="/assets/js/63.2b0fa974.js"><link rel="prefetch" href="/assets/js/64.2f400a86.js"><link rel="prefetch" href="/assets/js/65.4cf2386f.js"><link rel="prefetch" href="/assets/js/66.188c4b33.js"><link rel="prefetch" href="/assets/js/67.b4f824ac.js"><link rel="prefetch" href="/assets/js/68.d77410fc.js"><link rel="prefetch" href="/assets/js/69.6e24eb76.js"><link rel="prefetch" href="/assets/js/7.8cdfab2f.js"><link rel="prefetch" href="/assets/js/70.5ca51a92.js"><link rel="prefetch" href="/assets/js/71.35d7ed60.js"><link rel="prefetch" href="/assets/js/72.a7853bf5.js"><link rel="prefetch" href="/assets/js/73.a891df77.js"><link rel="prefetch" href="/assets/js/74.e978df7f.js"><link rel="prefetch" href="/assets/js/75.ab5a4524.js"><link rel="prefetch" href="/assets/js/76.ea1c6d79.js"><link rel="prefetch" href="/assets/js/77.711c0174.js"><link rel="prefetch" href="/assets/js/78.35dd5c6c.js"><link rel="prefetch" href="/assets/js/79.d7524830.js"><link rel="prefetch" href="/assets/js/8.badb7759.js"><link rel="prefetch" href="/assets/js/80.7e16490b.js"><link rel="prefetch" href="/assets/js/81.15f00868.js"><link rel="prefetch" href="/assets/js/82.0fe7b576.js"><link rel="prefetch" href="/assets/js/83.fc62b16f.js"><link rel="prefetch" href="/assets/js/84.2a4f555c.js"><link rel="prefetch" href="/assets/js/85.edffb2ef.js"><link rel="prefetch" href="/assets/js/86.69991118.js"><link rel="prefetch" href="/assets/js/87.621cee7a.js"><link rel="prefetch" href="/assets/js/88.5507cc10.js"><link rel="prefetch" href="/assets/js/89.5d34d988.js"><link rel="prefetch" href="/assets/js/9.d4fc76e7.js"><link rel="prefetch" href="/assets/js/90.cc841762.js"><link rel="prefetch" href="/assets/js/91.a24381d0.js"><link rel="prefetch" href="/assets/js/92.cbd5d458.js"><link rel="prefetch" href="/assets/js/93.530432c0.js"><link rel="prefetch" href="/assets/js/94.0524cfdd.js"><link rel="prefetch" href="/assets/js/95.0214ae22.js"><link rel="prefetch" href="/assets/js/96.7942792a.js"><link rel="prefetch" href="/assets/js/97.35d91de8.js"><link rel="prefetch" href="/assets/js/98.eafbdc44.js"><link rel="prefetch" href="/assets/js/99.db414aab.js">
    <link rel="stylesheet" href="/assets/css/0.styles.18a91880.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Gpingの知识库" class="logo"> <span class="site-name can-hide">Gpingの知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">🏠首页</a></div><div class="nav-item"><a href="/pages/2dbd58/" class="nav-link">📚小手册</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📖基础" class="dropdown-title"><!----> <span class="title" style="display:;">📖基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/27f9fa/" class="nav-link">Java8新特性</a></li><li class="dropdown-item"><!----> <a href="/pages/96d5aa/" class="nav-link">Java并发编程</a></li><li class="dropdown-item"><!----> <a href="/pages/00e30d/" class="nav-link">Java虚拟机</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🏷️框架" class="dropdown-title"><!----> <span class="title" style="display:;">🏷️框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/bb39d9/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/pages/24c3ee/" class="nav-link">SpringSecurity</a></li><li class="dropdown-item"><!----> <a href="/pages/1ab42b/" class="nav-link">ThingsBoard</a></li><li class="dropdown-item"><!----> <a href="/pages/fb96c3/" class="nav-link">Jpa</a></li><li class="dropdown-item"><!----> <a href="/pages/34b19f/" class="nav-link">Activiti7</a></li><li class="dropdown-item"><!----> <a href="/pages/d33c62/" class="nav-link">Quartz</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="⚔️中间件" class="dropdown-title"><!----> <span class="title" style="display:;">⚔️中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/c4d661/" class="nav-link">Rabbitmq</a></li><li class="dropdown-item"><!----> <a href="/pages/fe0a41/" class="nav-link">Kafka</a></li><li class="dropdown-item"><!----> <a href="/pages/eeddc3/" class="nav-link">Canal</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📁数据库" class="dropdown-title"><!----> <span class="title" style="display:;">📁数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/0ef684/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/a174cd/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4cfb74/" class="nav-link">InfluxDB</a></li><li class="dropdown-item"><!----> <a href="/pages/9c8057/" class="nav-link">ClickHouse</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🧰实用工具" class="dropdown-title"><!----> <span class="title" style="display:;">🧰实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/32a577/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/9864be/" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/pages/f5b30e/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/290042/" class="nav-link">Arthas</a></li><li class="dropdown-item"><!----> <a href="/pages/9eb455/" class="nav-link">Idea</a></li><li class="dropdown-item"><!----> <a href="/pages/151c97/" class="nav-link">开发工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🐞运维" class="dropdown-title"><!----> <span class="title" style="display:;">🐞运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/748b9f/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/4b6fee/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💡其他" class="dropdown-title"><!----> <span class="title" style="display:;">💡其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9cc0e1/" class="nav-link">高项</a></li><li class="dropdown-item"><!----> <a href="/pages/10e161/" class="nav-link">不一样的树形构建方式</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">🏠首页</a></div><div class="nav-item"><a href="/pages/2dbd58/" class="nav-link">📚小手册</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📖基础" class="dropdown-title"><!----> <span class="title" style="display:;">📖基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/27f9fa/" class="nav-link">Java8新特性</a></li><li class="dropdown-item"><!----> <a href="/pages/96d5aa/" class="nav-link">Java并发编程</a></li><li class="dropdown-item"><!----> <a href="/pages/00e30d/" class="nav-link">Java虚拟机</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🏷️框架" class="dropdown-title"><!----> <span class="title" style="display:;">🏷️框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/bb39d9/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/pages/24c3ee/" class="nav-link">SpringSecurity</a></li><li class="dropdown-item"><!----> <a href="/pages/1ab42b/" class="nav-link">ThingsBoard</a></li><li class="dropdown-item"><!----> <a href="/pages/fb96c3/" class="nav-link">Jpa</a></li><li class="dropdown-item"><!----> <a href="/pages/34b19f/" class="nav-link">Activiti7</a></li><li class="dropdown-item"><!----> <a href="/pages/d33c62/" class="nav-link">Quartz</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="⚔️中间件" class="dropdown-title"><!----> <span class="title" style="display:;">⚔️中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/c4d661/" class="nav-link">Rabbitmq</a></li><li class="dropdown-item"><!----> <a href="/pages/fe0a41/" class="nav-link">Kafka</a></li><li class="dropdown-item"><!----> <a href="/pages/eeddc3/" class="nav-link">Canal</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📁数据库" class="dropdown-title"><!----> <span class="title" style="display:;">📁数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/0ef684/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/a174cd/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4cfb74/" class="nav-link">InfluxDB</a></li><li class="dropdown-item"><!----> <a href="/pages/9c8057/" class="nav-link">ClickHouse</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🧰实用工具" class="dropdown-title"><!----> <span class="title" style="display:;">🧰实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/32a577/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/9864be/" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/pages/f5b30e/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/290042/" class="nav-link">Arthas</a></li><li class="dropdown-item"><!----> <a href="/pages/9eb455/" class="nav-link">Idea</a></li><li class="dropdown-item"><!----> <a href="/pages/151c97/" class="nav-link">开发工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🐞运维" class="dropdown-title"><!----> <span class="title" style="display:;">🐞运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/748b9f/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/4b6fee/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💡其他" class="dropdown-title"><!----> <span class="title" style="display:;">💡其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9cc0e1/" class="nav-link">高项</a></li><li class="dropdown-item"><!----> <a href="/pages/10e161/" class="nav-link">不一样的树形构建方式</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Rabbitmq</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Kafka</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/fe0a41/" class="sidebar-link">kafka介绍</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>kafka安装</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/pages/d0d03a/" class="sidebar-link">kafka历史数据清理策略以及配置</a></li><li><a href="/pages/a1c9ac/" aria-current="page" class="active sidebar-link">kafka命令行工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#topic-管理操作-kafka-topics" class="sidebar-link">topic 管理操作：kafka-topics</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/a1c9ac/#查看-topic-列表" class="sidebar-link">查看 topic 列表</a></li><li class="sidebar-sub-header level3"><a href="/pages/a1c9ac/#查看-topic-状态信息" class="sidebar-link">查看 topic 状态信息</a></li><li class="sidebar-sub-header level3"><a href="/pages/a1c9ac/#创建-topic" class="sidebar-link">创建 topic</a></li><li class="sidebar-sub-header level3"><a href="/pages/a1c9ac/#删除topic" class="sidebar-link">删除topic</a></li><li class="sidebar-sub-header level3"><a href="/pages/a1c9ac/#增加分区数" class="sidebar-link">增加分区数</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#生产者-kafka-console-producer" class="sidebar-link">生产者：kafka-console-producer</a></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#消费者-kafka-console-consumer" class="sidebar-link">消费者：kafka-console-consumer</a></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#消费位移记录" class="sidebar-link">消费位移记录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/a1c9ac/#获取消息编译量信息" class="sidebar-link">获取消息编译量信息</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#ack-应答机制参数配置" class="sidebar-link">Ack 应答机制参数配置</a></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#发送消息" class="sidebar-link">发送消息</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/a1c9ac/#发后即忘-fire-and-forget" class="sidebar-link">发后即忘(fire-and-forget）</a></li><li class="sidebar-sub-header level3"><a href="/pages/a1c9ac/#同步发送-sync" class="sidebar-link">同步发送(sync)</a></li><li class="sidebar-sub-header level3"><a href="/pages/a1c9ac/#异步发送-async" class="sidebar-link">异步发送(async)</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#producerrecord" class="sidebar-link">ProducerRecord</a></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#消费者api示例" class="sidebar-link">消费者Api示例</a></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#subscribe订阅主题" class="sidebar-link">subscribe订阅主题</a></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#assign订阅主题" class="sidebar-link">assign订阅主题</a></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#subscribe与assign的区别" class="sidebar-link">subscribe与assign的区别</a></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#取消订阅" class="sidebar-link">取消订阅</a></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#consumerrecord" class="sidebar-link">ConsumerRecord</a></li><li class="sidebar-sub-header level2"><a href="/pages/a1c9ac/#消息的消费模式" class="sidebar-link">消息的消费模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/a1c9ac/#推送模式-push-model" class="sidebar-link">推送模式（Push Model）</a></li><li class="sidebar-sub-header level3"><a href="/pages/a1c9ac/#拉取模式-pull-model" class="sidebar-link">拉取模式（Pull Model）</a></li></ul></li></ul></li><li><a href="/pages/f79ce6/" class="sidebar-link">springboot整合kafka</a></li><li><a href="/pages/c8dba6/" class="sidebar-link">kafka 系统的架构</a></li><li><a href="/pages/b0c4c7/" class="sidebar-link">kafka 关键原理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Canal</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>中间件</span></li><li data-v-06225672><span data-v-06225672>Kafka</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>gping</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-12-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">kafka命令行工具<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="命令行工具"><a href="#命令行工具" class="header-anchor">#</a> 命令行工具</h1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>Kafka 中提供了许多命令行工具（位于$KAFKA HOME/bin 目录下）用于管理集群的变更。</p> <table><thead><tr><th>命令</th> <th>用途</th></tr></thead> <tbody><tr><td>kafka-console-consumer.sh</td> <td>用于消费消息</td></tr> <tr><td>kafka-console-producer.sh</td> <td>用于生产消息</td></tr> <tr><td>kafka-topics.sh</td> <td>用于管理主题</td></tr> <tr><td>kafka-server-stop.sh</td> <td>用于关闭 Kafka 服务</td></tr> <tr><td>kafka-server-start.sh</td> <td>用于启动 Kafka 服务</td></tr> <tr><td>kafka-configs.sh</td> <td>用于配置管理</td></tr> <tr><td>kafka-consumer-perf-test.sh</td> <td>用于测试消费性能</td></tr> <tr><td>kafka-producer-perf-test.sh</td> <td>用于测试生产性能</td></tr> <tr><td>kafka-dump-log.sh</td> <td>用于查看数据日志内容</td></tr> <tr><td>kafka-preferred-replica-election.sh</td> <td>用于优先副本的选举</td></tr> <tr><td>kafka-reassign-partitions.sh</td> <td>用于分区重分配</td></tr></tbody></table> <h2 id="topic-管理操作-kafka-topics"><a href="#topic-管理操作-kafka-topics" class="header-anchor">#</a> topic 管理操作：kafka-topics</h2> <p><a href="https://kafka.apache.org/documentation/#topicconfigs" target="_blank" rel="noopener noreferrer">topic 配置参数文档地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="查看-topic-列表"><a href="#查看-topic-列表" class="header-anchor">#</a> 查看 topic 列表</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-topics.sh <span class="token parameter variable">--list</span> <span class="token parameter variable">--zookeeper</span> <span class="token number">192.168</span>.1.174:2182
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输出</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>/opt/kafka_2.13-2.8.1/bin <span class="token comment"># ./kafka-topics.sh --list --zookeeper 192.168.1.174:2182</span>
__consumer_offsets
topic.test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="查看-topic-状态信息"><a href="#查看-topic-状态信息" class="header-anchor">#</a> 查看 topic 状态信息</h3> <p>（1）查看 topic 详细信息</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">192.168</span>.1.174:2182 <span class="token parameter variable">--describe</span> <span class="token parameter variable">--topic</span> topic.test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输出</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>/opt/kafka_2.13-2.8.1/bin <span class="token comment"># ./kafka-topics.sh --zookeeper 192.168.1.174:2182 --describe --topic topic.test</span>
Topic: topic.test       TopicId: d04yzrIZTVG-V8n25-yq9A PartitionCount: <span class="token number">3</span>       ReplicationFactor: <span class="token number">2</span>    Configs: 
        Topic: topic.test       Partition: <span class="token number">0</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">1,3</span>   Isr: <span class="token number">1,3</span>
        Topic: topic.test       Partition: <span class="token number">1</span>    Leader: <span class="token number">2</span>       Replicas: <span class="token number">2,1</span>   Isr: <span class="token number">2,1</span>
        Topic: topic.test       Partition: <span class="token number">2</span>    Leader: <span class="token number">3</span>       Replicas: <span class="token number">3,2</span>   Isr: <span class="token number">3,2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><strong>Topic: topic.test</strong>: 这是指定的 Kafka 主题的名称。</li> <li><strong>TopicId</strong>: 这可能是内部标识符，用于标识该主题。</li> <li><strong>PartitionCount: 3</strong>: 主题被分为3个分区。</li> <li><strong>ReplicationFactor: 2</strong>: 每个分区有2个副本（即每个分区的数据将被复制到两个地方以确保冗余和容错性）。</li> <li><strong>Configs</strong>: 这里未显示任何配置信息。</li></ul> <p>接下来是有关每个分区的详细信息：</p> <ul><li><strong>Partition</strong>: 分区的编号。</li> <li><strong>Leader</strong>: 负责该分区的 Kafka broker 的 ID。</li> <li><strong>Replicas</strong>: 所有副本的 ID 列表。例如，对于 Partition 0，副本1和副本3。</li> <li><strong>Isr (In-Sync Replicas)</strong>: 正在同步的副本列表。这指的是处于活跃状态的副本，与 Leader 副本保持同步。</li></ul> <p>例如：</p> <ul><li>Partition 0: Leader 是 Broker 1，有两个副本：1和3，正在同步的副本是1和3。</li> <li>Partition 1: Leader 是 Broker 2，有两个副本：2和1，正在同步的副本是2和1。</li> <li>Partition 2: Leader 是 Broker 3，有两个副本：3和2，正在同步的副本是3和2。</li></ul> <h3 id="创建-topic"><a href="#创建-topic" class="header-anchor">#</a> 创建 topic</h3> <p>（1）基本方式</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">192.168</span>.1.174:2182 <span class="token parameter variable">--create</span> --replication-factor <span class="token number">3</span> <span class="token parameter variable">--partitions</span> <span class="token number">3</span> <span class="token parameter variable">--topic</span> t1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>本方式，副本的存储位置是系统自动决定的；</p> <ul><li><strong>--zookeeper 192.168.1.174:2182</strong>: 指定了 ZooKeeper 的连接信息，Kafka 使用 ZooKeeper 来维护集群的状态和元数据信息。</li> <li><strong>--create</strong>: 表示创建一个新的主题。</li> <li><strong>--replication-factor 3</strong>: 设置每个分区的副本数量为 3。这意味着每个分区的数据将被复制到集群中的其他两个 Kafka broker 中。</li> <li><strong>--partitions 3</strong>: 指定主题有 3 个分区。</li> <li><strong>--topic t1</strong>: 设置新创建的主题名称为 &quot;t1&quot;。</li></ul> <p>（2）手动指定分配方案：分区数，副本数，存储位置</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--topic</span> t2 <span class="token parameter variable">--zookeeper</span> <span class="token number">192.168</span>.1.174:2182 --replica-assignment <span class="token number">1</span>:3,1:2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>该 topic，将有如下 partition：</p> <ul><li><code>1:3</code>: 表示第一个分区（Partition 0）应该有 2 个副本 ，所在节点： broker1、broker3</li> <li><code>1:2</code>: 表示第二个分区（Partition 1）应该有 2个副本，所在节点： broker1、broker2</li></ul> <h3 id="删除topic"><a href="#删除topic" class="header-anchor">#</a> 删除topic</h3> <p><strong>step1：</strong></p> <p>kafka启动之前，在server.properties配置<strong>delete.topic.enable=true</strong></p> <p>如果没有设置，则会报出以下提示。topic只会标记为marked for deletion，加上配置后，重启kafka，之前的topick就真正删除了。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>/opt/kafka_2.13-2.8.1/bin <span class="token comment"># ./kafka-topics.sh --zookeeper 192.168.1.174:2182 --delete --topic t1</span>
Topic t1 is marked <span class="token keyword">for</span> deletion.
Note: This will have no impact <span class="token keyword">if</span> delete.topic.enable is not <span class="token builtin class-name">set</span> to <span class="token boolean">true</span>

<span class="token comment"># 注意：如果delete.topic.enable未设置为true，则不会产生任何影响</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>step2：执行以下命令</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">192.168</span>.1.174:2182 <span class="token parameter variable">--delete</span> <span class="token parameter variable">--topic</span> t1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当使用<code>kafka-topics.sh</code>脚本删除主题时，实际上触发了一个异步过程。这个过程的第一步是在ZooKeeper的<code>/admin/delete_topics</code>路径下创建一个名为待删除主题的节点。这个节点的创建代表着该主题被标记为待删除的状态。</p> <p>Kafka的控制器（Controller）会定期检查<code>/admin/delete_topics</code>路径下的节点，如果发现有被标记的主题节点，控制器就会开始删除这些主题。控制器会先将待删除主题的所有分区设置为不可用状态，并停止对这些分区的消息进行接收或写入。</p> <p>随后，控制器会将这些主题的分区从所有的副本集群中删除，并在删除完成后，从ZooKeeper中删除标记这个主题的节点。这样，整个主题删除过程就完成了。</p> <h3 id="增加分区数"><a href="#增加分区数" class="header-anchor">#</a> 增加分区数</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">192.168</span>.1.174:2182 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> t2 <span class="token parameter variable">--partitions</span> <span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>--partitions 3</code>指定了要将主题<code>'t2'</code>的分区数更改为3</li></ul> <p>输出</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>/opt/kafka_2.13-2.8.1/bin <span class="token comment"># ./kafka-topics.sh --zookeeper 192.168.1.174:2182 --alter --topic t2 --partitions 3</span>
WARNING: If partitions are increased <span class="token keyword">for</span> a topic that has a key, the partition logic or ordering of the messages will be affected
Adding partitions succeeded<span class="token operator">!</span>

<span class="token comment"># 警告：如果为具有键的主题增加分区，则分区逻辑或消息顺序将受到影响</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>Kafka 只支持增加分区，不支持减少分区。</p> <p>减少分区，代价太大（数据的转移，日志段拼接合并）。</p> <p>Kafka 不支持减少分区的主要原因在于分区的数据分布和数据的容错性。减少分区会引发一些问题：</p> <ul><li>数据丢失：分区中的消息数据可能会在减少分区时被删除，因为删除分区实际上是删除存储在该分区中的消息。</li> <li>分区间的数据移动：Kafka 不支持直接将分区的数据移动到其他分区。减少分区涉及将数据重新分布到新的分区中，这会带来大量的数据迁移操作。</li> <li>整体性能影响：数据重新平衡和迁移可能会对整个 Kafka 集群的性能产生负面影响，特别是在数据量大、分区多的情况下。</li></ul></div> <h2 id="生产者-kafka-console-producer"><a href="#生产者-kafka-console-producer" class="header-anchor">#</a> 生产者：kafka-console-producer</h2> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-console-producer.sh --broker-list <span class="token number">192.168</span>.1.174:9093 <span class="token parameter variable">--topic</span> t2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输入</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>/opt/kafka_2.13-2.8.1/bin <span class="token comment"># ./kafka-console-producer.sh --broker-list 192.168.1.174:9093 --topic t2</span>
<span class="token operator">&gt;</span>hellow
<span class="token operator">&gt;</span>xixi
<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="消费者-kafka-console-consumer"><a href="#消费者-kafka-console-consumer" class="header-anchor">#</a> 消费者：kafka-console-consumer</h2> <p>对于 Kafka 消费者在消费消息时指定起始偏移量，通常有三种策略：</p> <table><thead><tr><th>策略</th> <th>解释</th></tr></thead> <tbody><tr><td>earliest（最早）</td> <td>从主题分区中最早的消息偏移量开始消费。无论消费者组之前是否消费过该主题的消息，它都会从最早的消息开始。</td></tr> <tr><td>latest（最新）</td> <td>从主题分区中最新的消息偏移量开始消费。这意味着消费者会从当前的偏移量位置开始消费消息，忽略过去的消息。</td></tr> <tr><td>指定偏移量</td> <td>消费者可以明确指定一个特定的偏移量作为起始点。这允许消费者从已知的特定偏移量处开始消费消息，而不是最早或最新的消息。</td></tr></tbody></table> <p>Kafka 中的消息是有序号的，这个序号被称为消息偏移量（Offset）。</p> <p>在 Kafka 中，每个主题分区的消息偏移量是独立维护的，不同分区内的偏移量是相互独立的，并且在各个分区内，消息偏移量都是从 0 开始递增的。</p> <p><strong>（1）消费消息</strong></p> <p><strong>earliest（最早）的方式</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-console-consumer.sh --bootstrap-server <span class="token number">192.168</span>.1.174:9093 --from-beginning <span class="token parameter variable">--topic</span> t2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>--from-beginning</code>：表示从主题的起始偏移量开始消费消息。这意味着你想从主题 <code>t2</code> 的最早消息开始消费。</li> <li><code>--topic t2</code>：指定了要消费的主题为 <code>t2</code>。</li></ul> <p>输出</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>/opt/kafka_2.13-2.8.1/bin <span class="token comment"># ./kafka-console-consumer.sh --bootstrap-server 192.168.1.174:9093 --from-beginning --topic t2</span>
hellow
xixi
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>latest（最新）的方式</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-console-consumer.sh --bootstrap-server <span class="token number">192.168</span>.1.174:9093 <span class="token parameter variable">--topic</span> t2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>（2）指定要消费的分区和要消费的起始 offset</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-console-consumer.sh --bootstrap-server <span class="token number">192.168</span>.1.174:9093,192.168.1.174:9094,192.168.1.174:9095 <span class="token parameter variable">--topic</span> t2 <span class="token parameter variable">--offset</span> <span class="token number">2</span> <span class="token parameter variable">--partition</span> <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>--bootstrap-server 192.168.1.174:9093,192.168.1.174:9094,192.168.1.174:9095</code>：指定了 Kafka brokers 的连接信息。</li> <li><code>--topic t2</code>：指定要消费的主题为 <code>t2</code>。</li> <li><code>--offset 2</code>：指定了消费的起始偏移量为 <code>2</code>。这表示你想从分区 <code>0</code> 中的偏移量 <code>2</code> 开始消费消息。</li> <li><code>--partition 0</code>：指定了要消费的分区为 <code>0</code>。</li></ul> <p><strong>（3）消费组</strong></p> <blockquote><p>消费组是 kafka 为了提高消费并行度的一种机制！</p> <p>在 kafka 的底层逻辑中，任何一个消费者都有自己所属的组</p> <p>组和组之间，没有任何关系，大家都可以消费到目标 topic 的所有数据</p> <p>但是组内的各个消费者，就只能读到自己所分配到的 partitions</p> <p>KAFKA 中的消费组，可以动态增减消费者而且消费组中的消费者数量发生任意变动，都会重新分配分区消费任务</p></blockquote> <h2 id="消费位移记录"><a href="#消费位移记录" class="header-anchor">#</a> 消费位移记录</h2> <p>kafka 的消费者，可以记录自己所消费到的消息偏移量，记录的这个偏移量就叫（消费位移）；记录这个消费到的位置，作用就在于消费者重启后可以接续上一次消费到位置来继续往后面消费；</p> <p>在Kafka中，__consumer_offsets主题用于存储消费者组的消费位移信息。这个主题包含了消费者组内每个消费者的偏移量（offset），并记录了消费者组在各个分区上消费消息的位置。</p> <blockquote><p>消费位移，是组内共享的！！！</p></blockquote> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-console-consumer.sh --bootstrap-server <span class="token number">192.168</span>.1.182:9093 <span class="token parameter variable">--topic</span> __consumer_offsets <span class="token parameter variable">--formatter</span> <span class="token string">&quot;kafka.coordinator.group.GroupMetadataManager\<span class="token variable">$OffsetsMessageFormatter</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>--formatter &quot;kafka.coordinator.group.GroupMetadataManager\$OffsetsMessageFormatter&quot;</code>: 使用了特定的消息格式化程序来解析 <code>__consumer_offsets</code> 主题中的消息。这个格式化程序 <code>kafka.coordinator.group.GroupMetadataManager$OffsetsMessageFormatter</code> 负责将消息进行解析，并以可读的方式展示消息中的偏移量信息。</li></ul> <p><strong>输出：</strong></p> <p>通过指定 formatter 工具类，来对__consumer_offsets 主题中的数据进行解析；</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>consumer.group1,oms_alert_data_topic,2<span class="token punctuation">]</span>::OffsetAndMetadata<span class="token punctuation">(</span>offset<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">leaderEpoch</span><span class="token operator">=</span>Optional.empty, <span class="token assign-left variable">metadata</span><span class="token operator">=</span>, <span class="token assign-left variable">commitTimestamp</span><span class="token operator">=</span><span class="token number">1703641636192</span>, <span class="token assign-left variable">expireTimestamp</span><span class="token operator">=</span>None<span class="token punctuation">)</span>
<span class="token punctuation">[</span>consumer.group2,oms_alert_data_topic,2<span class="token punctuation">]</span>::OffsetAndMetadata<span class="token punctuation">(</span>offset<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">leaderEpoch</span><span class="token operator">=</span>Optional.empty, <span class="token assign-left variable">metadata</span><span class="token operator">=</span>, <span class="token assign-left variable">commitTimestamp</span><span class="token operator">=</span><span class="token number">1703641636239</span>, <span class="token assign-left variable">expireTimestamp</span><span class="token operator">=</span>None<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>解释：</strong></p> <ul><li><strong>消费者组</strong>：<code>consumer.group1</code></li> <li><strong>主题</strong>：<code>oms_alert_data_topic</code></li> <li><strong>分区</strong>：2</li> <li><strong>消费位移（Offset）</strong>：1</li> <li><strong>leaderEpoch</strong>：未指定（Optional.empty）</li> <li><strong>元数据（Metadata）</strong>：空</li> <li><strong>提交时间戳（Commit Timestamp）</strong>：1703641636192，以毫秒为单位的时间戳，表示此消费位移被提交的时间。</li> <li><strong>过期时间戳（Expire Timestamp）</strong>：未设置过期时间（None）</li></ul> <p>如果在输入该命令后没有返回任何信息，可能 <code>__consumer_offsets</code> 主题中没有存储任何消息。这个主题用于内部记录消费者组的偏移量信息，如果当前没有活跃的消费者组，可能就没有消息。</p> <h3 id="获取消息编译量信息"><a href="#获取消息编译量信息" class="header-anchor">#</a> 获取消息编译量信息</h3> <p>如果需要获取某个特定 consumer-group 的如果需要获取某个特定 consumer-group 的消费偏移量信息，则需要计算该消费组的偏移量记录所在分区，则需要计算该消费组的偏移量记录所在分区。</p> <p>分区的计算方式通常是通过消费者组的ID进行哈希计算，使得不同消费者组的信息能够分布在不同的分区上。</p> <p>举例来说，如果要获取消费者组 <code>consumer.group1</code> 的消费偏移量信息，需要使用以下计算方式：</p> <p>假设__consumer_offsets主题有50个分区，消费组 <code>consumer.group1</code>的ID为 &quot;d30&quot;。</p> <ol><li><p>计算消费者组的分区编号： <code>Math.abs(&quot;consumer.group1&quot;.hashCode()) % 50</code> （这里假设numPartitions为50）</p> <p>计算结果即为该消费组在__consumer_offsets主题中的分区编号。</p></li> <li><p>通过指定分区获取消费偏移量信息： 使用指定的分区编号，可以针对__consumer_offsets主题的对应分区来获取特定消费者组的消费位移信息。</p></li></ol> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-topics.sh --bootstrap-server <span class="token number">192.168</span>.1.182:9093 <span class="token parameter variable">--describe</span> <span class="token parameter variable">--topic</span> __consumer_offsets
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（1）查看__consumer_offsets主题有多少分区可通过以下命令</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-topics.sh --bootstrap-server <span class="token number">192.168</span>.1.182:9093 <span class="token parameter variable">--describe</span> <span class="token parameter variable">--topic</span> __consumer_offsets
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（2）查看有哪些消费者组可通过以下命令</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-consumer-groups.sh --bootstrap-server <span class="token number">192.168</span>.1.182:9093 <span class="token parameter variable">--list</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（3）消费者组 &quot;abcx&quot; 的ID可通过以下命令</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./kafka-consumer-groups.sh --bootstrap-server <span class="token number">192.168</span>.1.182:9093 <span class="token parameter variable">--describe</span> <span class="token parameter variable">--group</span> consumer.group1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输出</p> <p><img src="https://gitee.com/studentgitee/note-picture/raw/master/image-20231227112751044.png" alt="image-20231227112751044"></p> <p>解释这些列的含义：</p> <ul><li><strong>GROUP</strong>：消费者组的名称或者ID。</li> <li><strong>TOPIC</strong>：主题名称，消费者组正在订阅的主题。</li> <li><strong>PARTITION</strong>：主题的分区编号。</li> <li><strong>CURRENT-OFFSET</strong>：当前消费者组在该分区上的消费位移（offset），即消费者已经消费到的消息位移。</li> <li><strong>LOG-END-OFFSET</strong>：该分区最新的消息位移，即日志中最新消息的位移。</li> <li><strong>LAG</strong>：消费者组的落后值（Lag），表示当前消费者组在该分区上落后的消息数量。</li> <li><strong>CONSUMER-ID</strong>：消费者的唯一标识符。</li> <li><strong>HOST</strong>：消费者所在的主机信息。</li> <li><strong>CLIENT-ID</strong>：消费者的客户端标识符。</li></ul> <h1 id="producer生产者"><a href="#producer生产者" class="header-anchor">#</a> producer生产者</h1> <h2 id="ack-应答机制参数配置"><a href="#ack-应答机制参数配置" class="header-anchor">#</a> Ack 应答机制参数配置</h2> <table><thead><tr><th style="text-align:center;">ack参数值</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">0</td> <td style="text-align:center;">生产者发出消息后不等待服务端的确认</td></tr> <tr><td style="text-align:center;">1</td> <td style="text-align:center;">生产者发出消息后要求服务端的分区 leader 确保数据存储成功后发送一个确认信息</td></tr> <tr><td style="text-align:center;">-1（all）</td> <td style="text-align:center;">生产者发出消息后要求服务端的分区的 ISR 副本全部同步成功后发送一个确认信息</td></tr></tbody></table> <p>生产者的 ack=all，其实也不能完全保证数据发送的 100%可靠性。</p> <p>为什么？因为，如果服务端目标 partition 的同步副本只有 leader 自己了，此时，它收到数据就会给生产者反馈成功！</p> <p>可以修改服务端的一个参数（分区最小 ISR 数[min.insync.replicas]&gt;=2），来避免此问题。</p> <h2 id="发送消息"><a href="#发送消息" class="header-anchor">#</a> 发送消息</h2> <p>一个正常的生产逻辑需要具备以下几个步骤</p> <ol><li>配置生产者参数及创建相应的生产者实例</li> <li>构建待发送的消息</li> <li>发送消息</li> <li>关闭生产者实例</li></ol> <p>首先，引入依赖</p> <div class="language-maven line-numbers-mode"><pre class="language-text"><code>&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;
	&lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>创建生产者实例和构建消息之后 就可以开始发送消息了。<strong>发送消息主要有3种模式 ：发后即忘、同步、异步</strong></p> <h3 id="发后即忘-fire-and-forget"><a href="#发后即忘-fire-and-forget" class="header-anchor">#</a> 发后即忘(fire-and-forget）</h3> <p>发后即忘，它只管往 Kafka 发送，并不关心消息是否正确到达。</p> <p>在大多数情况下，这种发送方式没有问题.不过在某些时候（比如发生不可重试异常时）会造成消息的丢失。</p> <p><strong>这种发送方式的性能最高，可靠性最差。</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置 kafka 集群的地址</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.1.174:9093,192.168.1.174:9094,192.168.1.174:9095&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ack 模式，取值有 0，1，-1（all） ， all 是最慢但最安全的</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;acks&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 失败重试次数（有可能会造成数据的乱序）</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;retries&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 数据发送的批次大小</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;batch.size&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一次数据发送请求所能发送的最大数据量</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;max.request.size&quot;</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 消息在缓冲区保留的时间，超过设置的值就会被提交到服务端</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;linger.ms&quot;</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 整个 Producer 用到总内存的大小，如果缓冲区满了会提交数据到服务端</span>
        <span class="token comment">// buffer.memory 要大于 batch.size，否则会报申请内存不足的错误</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;buffer.memory&quot;</span><span class="token punctuation">,</span> <span class="token number">10240</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 序列化器</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key.serializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;value.serializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;dd:&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="同步发送-sync"><a href="#同步发送-sync" class="header-anchor">#</a> 同步发送(sync)</h3> <p>同步发送的方式可靠性最高，要么消息发送成功，要么发生异常。如果发生异常，会catch并处理异常。</p> <p>同步发送的性能会差一些，需要阻塞等待一条消息发送完，才能发送下一条。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
	producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ExecutionException</span> <span class="token operator">|</span> <span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;send record get error&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyProducerSync</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置 kafka 集群的地址</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.1.174:9093,192.168.1.174:9094,192.168.1.174:9095&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ack 模式，取值有 0，1，-1（all） ， all 是最慢但最安全的</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;acks&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 失败重试次数（有可能会造成数据的乱序）</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;retries&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 数据发送的批次大小</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;batch.size&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一次数据发送请求所能发送的最大数据量</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;max.request.size&quot;</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 消息在缓冲区保留的时间，超过设置的值就会被提交到服务端</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;linger.ms&quot;</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 整个 Producer 用到总内存的大小，如果缓冲区满了会提交数据到服务端</span>
        <span class="token comment">// buffer.memory 要大于 batch.size，否则会报申请内存不足的错误</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;buffer.memory&quot;</span><span class="token punctuation">,</span> <span class="token number">10240</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 序列化器</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key.serializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;value.serializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">RecordMetadata</span> t2 <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;dd:&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

        producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="异步发送-async"><a href="#异步发送-async" class="header-anchor">#</a> 异步发送(async)</h3> <p>回调函数会在 producer 收到 ack 时调用，为异步调用。</p> <p>该方法有两个参数，分别是 RecordMetadata 和Exception：</p> <ul><li>如果 Exception 为 null，说明消息发送成功。</li> <li>如果 Exception 不为 null，说明消息发送失败。</li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>消息发送失败会自动重试，不需要我们在回调函数中手动重试。</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code>producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCompletion</span><span class="token punctuation">(</span><span class="token class-name">RecordMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span>exception <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    		log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;send onCompletion error.&quot;</span> <span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
   		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>metadata<span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> metadata<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> metadata<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  	     <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyProducerAsync</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Kafka 服务端的主机名和端口号</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.1.174:9093,192.168.1.174:9094,192.168.1.174:9095&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 等待所有副本节点的应答</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;acks&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 消息发送最大尝试次数</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;retries&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一批消息处理大小</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;batch.size&quot;</span><span class="token punctuation">,</span> <span class="token number">16384</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 增加服务端请求延时</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;linger.ms&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 发送缓存区内存大小</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;buffer.memory&quot;</span><span class="token punctuation">,</span> <span class="token number">33554432</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// key 序列化</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key.serializer&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// value 序列化</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;value.serializer&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            kafkaProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCompletion</span><span class="token punctuation">(</span><span class="token class-name">RecordMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>metadata <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>metadata<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> metadata<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        kafkaProducer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="producerrecord"><a href="#producerrecord" class="header-anchor">#</a> ProducerRecord</h2> <p>消息对象 ProducerRecord，除了包含业务数据外，还包含了多个属性：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// 消息要发送到的目标主题的名称</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> topic<span class="token punctuation">;</span>
    <span class="token comment">// 可选项，指定消息应该发送到的特定分区。如果不指定分区，Kafka 会根据消息的键（key）进行分区选择。</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> partition<span class="token punctuation">;</span>
    <span class="token comment">// 可选项，消息的头信息，用于包含一些元数据信息。</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Headers</span> headers<span class="token punctuation">;</span>
    <span class="token comment">// 消息的键，用于在发送消息时进行分区决策。如果指定了分区，消息会被发送到指定分区中。</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>
    <span class="token comment">// 消息的实际内容，要发送的有效负载数据。</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">V</span> value<span class="token punctuation">;</span>
    <span class="token comment">// 可选项，消息的时间戳，用于指定消息的时间。</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Long</span> timestamp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h1 id="consumer消费者"><a href="#consumer消费者" class="header-anchor">#</a> consumer消费者</h1> <h2 id="消费者api示例"><a href="#消费者api示例" class="header-anchor">#</a> 消费者Api示例</h2> <p>一个正常的消费逻辑需要具备以下几个步骤：</p> <ol><li>配置消费者客户端参数及创建相应的消费者实例；</li> <li>订阅主题 topic；</li> <li>拉取消息并消费；</li> <li>定期向__consumer_offsets 主题提交消费位移 offset；</li> <li>关闭消费者实例。</li></ol> <h2 id="subscribe订阅主题"><a href="#subscribe订阅主题" class="header-anchor">#</a> subscribe订阅主题</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 允许消费者订阅一个给定的主题集合</span>
<span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> topics<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 类似于上一个方法，但允许你提供一个 ConsumerRebalanceListener 的回调函数。</span>
<span class="token comment">// 这个回调函数会在重新平衡（Rebalance）发生时被触发。</span>
<span class="token comment">// 重新平衡指的是消费者群组成员变化时分区分配发生变化的情况。回调函数中的逻辑可以用于在分区重新分配时执行一些特定操作。</span>
<span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> topics<span class="token punctuation">,</span> <span class="token class-name">ConsumerRebalanceListener</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 允许使用正则表达式的 Pattern 对象订阅主题。消费者将订阅符合该模式的所有主题，并监听从这些主题中接收到的消息。</span>
<span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Pattern</span> pattern<span class="token punctuation">,</span> <span class="token class-name">ConsumerRebalanceListener</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 类似于上一个方法，但不提供回调函数。这个方法让消费者使用正则表达式模式订阅主题，但在分区重新平衡时不触发回调函数。</span>
<span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Pattern</span> pattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>指定集合方式订阅主题</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>topicl <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>topic2<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>正则方式订阅主题</li></ul> <p>如果消费者采用的是正则表达式的方式（subscribe(Pattern)）订阅， 在之后的过程中，如果有人又创建了新的主题，并且主题名字与正表达式相匹配，那么这个消费者就可以消费到新添加的主题中的消息。如果应用程序需要消费多个主题，并且可以处理不同的类型，那么这种订阅方式就很有效。</p> <p>正则表达式的方式订阅的示例如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Pattern</span><span class="token punctuation">.</span>compile <span class="token punctuation">(</span><span class="token string">&quot;topic.*&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>利用正则表达式订阅主题，可实现动态订阅。</p> <h2 id="assign订阅主题"><a href="#assign订阅主题" class="header-anchor">#</a> assign订阅主题</h2> <p>消费者不仅可以通过 KafkaConsumer.subscribe() 方法订阅主题，还可直接订阅某些主题的指定分区；</p> <p>在 KafkaConsumer 中提供了 assign() 方法来实现这些功能，此方法的具体定义如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TopicPartition</span><span class="token punctuation">&gt;</span></span> partitions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个方法只接受参数 partitions，用来指定需要订阅的分区集合。示例如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>consumer<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TopicPartition</span> <span class="token punctuation">(</span><span class="token string">&quot;tpc_1&quot;</span> <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span>“tpc_2”<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="subscribe与assign的区别"><a href="#subscribe与assign的区别" class="header-anchor">#</a> subscribe与assign的区别</h2> <ol><li><strong>subscribe</strong>：
<ul><li><code>subscribe</code> 是一种自动分配分区的模式。</li> <li>消费者会向Kafka集群订阅一个或多个主题，并指定一个消费者组。</li> <li>Kafka会根据消费者组内部的消费者数量和主题的分区数量自动均衡地分配分区给各个消费者。</li> <li>当消费者组中的消费者数量发生变化（例如增加或减少消费者）或者主题的分区数量发生变化时，Kafka会自动进行重新平衡（rebalance），重新分配分区给消费者。</li> <li>使用 <code>subscribe</code> 模式时，消费者不需要关心具体的分区分配细节。</li></ul></li> <li><strong>assign</strong>：
<ul><li><code>assign</code> 是一种手动分配分区的模式。</li> <li>消费者可以直接指定要消费的主题分区列表，而不是订阅整个主题。</li> <li>在 <code>assign</code> 模式下，消费者可以精确控制自己消费哪些分区，但需要自行处理分区分配和负载均衡的问题。</li> <li>当使用 <code>assign</code> 模式时，Kafka不会自动进行重新平衡。如果消费者想要改变消费的分区，需要手动调用 <code>assign</code> 方法更新分区列表。</li> <li>使用 <code>assign</code> 模式时，消费者可以选择不指定消费者组，或者指定一个消费者组，但这种情况下，Kafka不会为同一个组内的其他消费者自动分配分区。</li></ul></li></ol> <p>总结来说，<code>subscribe</code> 模式适用于需要动态调整分区分配和消费者数量的场景，由Kafka自动管理分区分配和重新平衡。而 <code>assign</code> 模式适用于需要精细控制分区消费和不依赖Kafka自动管理的场景，但需要开发者自行处理分区分配和负载均衡的问题。</p> <h2 id="取消订阅"><a href="#取消订阅" class="header-anchor">#</a> 取消订阅</h2> <p>既然有订阅，那么就有取消订阅；
可以使用 KafkaConsumer 中的 unsubscribe()方法采取消主题的订阅，这个方法既可以取消通过subscribe( Collection）方式实现的订阅；</p> <p>也可以取消通过 subscribe(Pattem）方式实现的订阅，还可以取消通过 assign( Collection）方式实现的订阅。示例码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>consumer<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果将 subscribe(Collection )或 assign(Collection）集合参数设置为空集合，作用与 unsubscribe()方法相同，如下示例中三行代码的效果相同：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>consumer<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

consumer<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TopicPartition</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="consumerrecord"><a href="#consumerrecord" class="header-anchor">#</a> ConsumerRecord</h2> <p>消费者消费到的每条消息的类型为 ConsumerRecord</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> <span class="token constant">NO_TIMESTAMP</span> <span class="token operator">=</span> <span class="token class-name">RecordBatch</span><span class="token punctuation">.</span><span class="token constant">NO_TIMESTAMP</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">NULL_SIZE</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * @deprecated checksums are no longer exposed by this class, this constant will be removed in Apache Kafka 4.0
     *             (deprecated since 3.0).
     */</span>
    <span class="token annotation punctuation">@Deprecated</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">NULL_CHECKSUM</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">// 消息所属的主题名称</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> topic<span class="token punctuation">;</span>
    <span class="token comment">// 消息所在的分区编号。</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> partition<span class="token punctuation">;</span>
    <span class="token comment">// 消息的偏移量，表示消息在分区中的位置。</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">long</span> offset<span class="token punctuation">;</span>
    <span class="token comment">// 消息的时间戳，表示消息产生的时间。</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">long</span> timestamp<span class="token punctuation">;</span>
    <span class="token comment">// 时间戳类型，表示时间戳的类型。</span>
    <span class="token comment">// 有两种类型 CreateTime 和 LogAppendTime，分别代表消息创建的时间戳和消息追加，到日志的时间戳。</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TimestampType</span> timestampType<span class="token punctuation">;</span>
    <span class="token comment">// 序列化键的大小（字节数）</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> serializedKeySize<span class="token punctuation">;</span>
    <span class="token comment">// 序列化值的大小（字节数）</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> serializedValueSize<span class="token punctuation">;</span>
    <span class="token comment">// 消息的头信息，包含一些元数据。</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Headers</span> headers<span class="token punctuation">;</span>
    <span class="token comment">// 消息的键。</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>
    <span class="token comment">// 消息的值。</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">V</span> value<span class="token punctuation">;</span>
    <span class="token comment">// 领导者副本的 epoch（领导者副本的版本号）</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> leaderEpoch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="消息的消费模式"><a href="#消息的消费模式" class="header-anchor">#</a> 消息的消费模式</h2> <p>Kafka 中的消费是基于拉取模式的。</p> <p>消息的消费一般有两种模式：</p> <h3 id="推送模式-push-model"><a href="#推送模式-push-model" class="header-anchor">#</a> <strong>推送模式（Push Model）</strong></h3> <p>在推送模式中，消息生产者将消息直接发送给消费者。一旦消息到达消息队列，系统会主动将消息推送给订阅了该主题的消费者。消费者不需要主动请求，而是被动地接收来自消息队列的消息。由于各消费者处理消息的能力不一样，所以这种方式某些消费者可能消费不过来推过来的消息。</p> <p><img src="https://gitee.com/studentgitee/note-picture/raw/master/8a3aa248ba7b92797a0cc7875b94d767.png" alt="8a3aa248ba7b92797a0cc7875b94d767"></p> <p>这种模式下，消息队列负责管理和分发消息，消费者只需要等待并处理传送过来的消息。典型的实现有订阅-发布（Pub/Sub）模型，其中发布者将消息发布到主题，所有订阅了该主题的消费者都会接收到这些消息。</p> <p>Kafka 使用的是拉取模式。消费者负责从 Kafka 集群中主动拉取数据，它们通过轮询的方式从指定的主题中获取消息。消费者可以控制自己的消费速率和时机，并以自己的节奏处理消息。</p> <h3 id="拉取模式-pull-model"><a href="#拉取模式-pull-model" class="header-anchor">#</a> <strong>拉取模式（Pull Model）</strong></h3> <p>在拉取模式中，消费者主动向消息队列发起请求，以获取消息。消费者定期或根据需要向消息队列发出请求，并获取可用的消息。消费者控制消息获取的频率和数量。</p> <p><img src="https://gitee.com/studentgitee/note-picture/raw/master/ca9412b7483dbbad3f790ac9c73d9e6e.png" alt="ca9412b7483dbbad3f790ac9c73d9e6e"></p> <p>这种模式下，消费者具有更多的控制权和灵活性，可以根据自己的需求自由地拉取消息。这通常需要消费者轮询消息队列，以检查是否有新的消息可用。</p> <p>RabbitMQ 通常采用推送模式。消息代理（Broker）主动将消息推送给订阅了特定队列或交换机的消费者。一旦消息到达队列或满足特定条件，消息代理就会将消息推送给等待的消费者。</p></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/01/25, 17:13:40</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/d0d03a/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">kafka历史数据清理策略以及配置</div></a> <a href="/pages/f79ce6/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">springboot整合kafka</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/d0d03a/" class="prev">kafka历史数据清理策略以及配置</a></span> <span class="next"><a href="/pages/f79ce6/">springboot整合kafka</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2024
    <span>Gping | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.57e44612.js" defer></script><script src="/assets/js/2.ea24d1ee.js" defer></script><script src="/assets/js/174.1cacb422.js" defer></script>
  </body>
</html>
